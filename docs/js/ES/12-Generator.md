ä¸‹é¢ç»™ä½ ä¸€ä»½ **JavaScript Generatorï¼ˆç”Ÿæˆå™¨ï¼‰çŸ¥è¯†ç‚¹å¤§å…¨ + é«˜è´¨é‡é¢è¯•é¢˜é™„ç­”æ¡ˆ**ã€‚
è¿™ä»½å†…å®¹è¦†ç›– **æ¦‚å¿µ â†’ æœ¬è´¨ â†’ æœºåˆ¶ â†’ é«˜çº§ç‰¹æ€§ â†’ é¢è¯•æ˜“è€ƒç‚¹**ï¼Œæ˜¯ä½ é¢è¯•ã€å¤ä¹  JS è¿›é˜¶èƒ½åŠ›çš„æœ€ä½³èµ„æ–™ã€‚

---

# ğŸŒ€ ä¸€ã€Generator çš„æ ¸å¿ƒæ¦‚å¿µï¼ˆè®°ä½è¿™ 3 å¥å°±å¤Ÿï¼‰

### **1. Generator æ˜¯ä¸€ç§å¯â€œæš‚åœ / æ¢å¤æ‰§è¡Œâ€çš„å‡½æ•°**

å’Œæ™®é€šå‡½æ•°ä¸åŒï¼š

* æ™®é€šå‡½æ•°ï¼šä¸€æ‰§è¡Œåˆ°åº•
* Generatorï¼šå¯ä»¥åˆ†æ®µæ‰§è¡Œï¼ˆé€šè¿‡ `yield` æš‚åœï¼Œé€šè¿‡ `next()` æ¢å¤ï¼‰

---

### **2. è°ƒç”¨ Generator ä¸ä¼šæ‰§è¡Œå‡½æ•°ä½“ï¼Œè€Œæ˜¯è¿”å›ä¸€ä¸ªè¿­ä»£å™¨å¯¹è±¡**

```js
function* gen() {}
const it = gen(); // æ­¤æ—¶ä¸ä¼šæ‰§è¡Œå‡½æ•°å†…éƒ¨ä»£ç 
```

ç”Ÿæˆå™¨å‡½æ•°è¿”å›çš„æ˜¯ä¸€ä¸ª **iterator + iterable** å¯¹è±¡ã€‚

---

### **3. `yield` æ˜¯åˆ†æ®µæ‰§è¡Œçš„å…³é”®**

```js
function* test() {
  yield 1;
  yield 2;
  return 3;
}
```

---

# ğŸ§© äºŒã€Generator çš„æ‰§è¡Œæœºåˆ¶ï¼ˆéå¸¸é‡è¦ï¼‰

### `next()` åšäº†ä»€ä¹ˆï¼Ÿ

è°ƒç”¨ `next(value)` ä¼šï¼š

1. è®©ç”Ÿæˆå™¨ç»§ç»­æ‰§è¡Œï¼Œç›´åˆ°é‡åˆ°ä¸‹ä¸€ä¸ª `yield` æˆ–ç»“æŸ
2. è¿”å›ä¸€ä¸ªå¯¹è±¡ï¼š

```js
{ value: xxx, done: false/true }
```

---

## ğŸ”„ Generator çš„æš‚åœç‚¹ä¸æ¢å¤ç‚¹

ç¤ºä¾‹ï¼š

```js
function* g() {
  console.log("A");
  yield 1; // æš‚åœç‚¹1
  console.log("B");
  yield 2; // æš‚åœç‚¹2
  console.log("C");
  return 3;
}
```

æ‰§è¡Œé¡ºåºï¼š

```js
const it = g();

it.next(); // æ‰“å° "A"ï¼Œé‡åˆ° yield 1 æš‚åœ â†’ è¿”å› {value:1, done:false}
it.next(); // æ‰“å° "B"ï¼Œé‡åˆ° yield 2 æš‚åœ â†’ è¿”å› {value:2, done:false}
it.next(); // æ‰“å° "C"ï¼Œreturn 3 â†’ è¿”å› {value:3, done:true}
```

ç”Ÿæˆå™¨çš„å…³é”®ç‚¹ï¼š
**æ¯æ¬¡ next() çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šè¢«ä¿å­˜ï¼Œä¸ä¼šé‡æ–°æ‰§è¡Œä¹‹å‰çš„ä»£ç ã€‚**

---

# ğŸ“¥ ä¸‰ã€`next(value)` çš„åŒå‘ä¼ å€¼æœºåˆ¶ï¼ˆé¢è¯•é«˜é¢‘ï¼ï¼ï¼ï¼‰

ä¾‹å­ï¼š

```js
function* g() {
  const a = yield 1;
  const b = yield a + 2;
  return b * 2;
}

const it = g();

console.log(it.next());      // {value:1, done:false}
console.log(it.next(10));    // a=10 â†’ yield a+2 = 12 â†’ {value:12, done:false}
console.log(it.next(5));     // b=5 â†’ return 10 â†’ {value:10, done:true}
```

**å…³é”®ç‚¹ï¼š**

> `next(value)` çš„å‚æ•°ä¼šä½œä¸ºä¸Šä¸€æ¬¡ `yield` çš„è¿”å›å€¼ã€‚

è¿™æ˜¯åç¨‹ï¼ˆco-routineï¼‰æ€æƒ³çš„ä¸€ç§åº”ç”¨ã€‚

---

# ğŸ“¤ å››ã€`return()` & `throw()`ï¼ˆé«˜çº§é¢˜å¸¸è€ƒï¼‰

## `iterator.return(value)`

æå‰ç»“æŸç”Ÿæˆå™¨ï¼š

```js
function* g() {
  yield 1;
  yield 2;
  yield 3;
}

const it = g();

console.log(it.return(99)); // {value:99, done:true}
console.log(it.next());     // {value:undefined, done:true}
```

å½“ `for...of` é‡åˆ° `break` æ—¶åº•å±‚ä¼šè‡ªåŠ¨è°ƒç”¨ `return()`ï¼Œç”¨æ¥é‡Šæ”¾èµ„æºï¼ˆå¦‚æ–‡ä»¶ã€ç½‘ç»œè¿æ¥ï¼‰ã€‚

---

## `iterator.throw(error)`

åœ¨ generator å†…éƒ¨æŠ›å‡ºå¼‚å¸¸ï¼š

```js
function* g() {
  try {
    yield 1;
  } catch (err) {
    console.log("å†…éƒ¨æ•è·:", err);
  }
  yield 2;
}

const it = g();
it.next();
it.throw("å¤–éƒ¨é”™è¯¯"); // å†…éƒ¨æ•è·
it.next();
```

è¿™ä½“ç°äº† Generator æ˜¯**å¯æ§æ‰§è¡Œçš„åç¨‹**ã€‚

---

# ğŸ§µ äº”ã€`yield*`ï¼ˆå§”æ‰˜ç”Ÿæˆå™¨ï¼‰

è®©ä¸€ä¸ª generator å¯ä»¥ â€œåµŒå¥—éå†å¦ä¸€ä¸ª iterableâ€ã€‚

```js
function* inner() {
  yield 1;
  yield 2;
}

function* outer() {
  yield 0;
  yield* inner(); // å§”æ‰˜
  yield 3;
}

[...outer()] // [0,1,2,3]
```

**é¢è¯•é‡ç‚¹ï¼š** `yield*` ä¼šè‡ªåŠ¨éå† iterableï¼Œå¹¶æŠŠå†…éƒ¨çš„ return å€¼ä½œä¸ºè‡ªå·±çš„ yield ç»“æœã€‚

---

# ğŸ§¨ å…­ã€Generator çš„å®é™…ç”¨é€”ï¼ˆå¸¸è€ƒåº”ç”¨é¢˜ï¼‰

### 1. å®ç°è‡ªå®šä¹‰ Iteratorï¼ˆGenerator æ˜¯æœ€ç®€å•çš„æ–¹æ¡ˆï¼‰

```js
function* range(start, end) {
  for (let i = start; i <= end; i++) yield i;
}
```

---

### 2. æƒ°æ€§æ±‚å€¼ï¼ˆLazy Evaluationï¼‰

æ¯”å¦‚æ— é™åºåˆ—ï¼ˆæ–æ³¢é‚£å¥‘ï¼‰ï¼š

```js
function* fib() {
  let a = 0, b = 1;
  while (true) {
    yield a;
    [a, b] = [b, a + b];
  }
}
```

å¯è¢« `take()` ç­‰å‡½æ•°æŒ‰éœ€æˆªå–ã€‚

---

### 3. æ§åˆ¶å¼‚æ­¥æµç¨‹ï¼ˆasync/await ä¹‹å‰ï¼ŒRedux-Saga è‡³ä»Šä»è¿™ä¹ˆåšï¼‰

```js
function* task() {
  const data = yield fetch("/api");
  console.log(data);
}
```

æ¡†æ¶ï¼ˆå¦‚ co / redux-sagaï¼‰ä¼šè‡ªåŠ¨æ‰§è¡Œè¿™äº›ç”Ÿæˆå™¨ã€‚

---

### 4. å®ç°åç¨‹ï¼ˆGenerator æ˜¯ JS ä¸­å”¯ä¸€èƒ½æš‚åœ/æ¢å¤æ‰§è¡Œçš„è¯­æ³•ï¼‰

---

# ğŸ§  ä¸ƒã€Generator çš„æ‰€æœ‰çŸ¥è¯†ç‚¹æ€»ç»“å›¾ï¼ˆè¶…æ¸…æ™°ï¼‰

```
Generator = function* + yield + å¯æš‚åœ/æ¢å¤æ‰§è¡Œ

æ ¸å¿ƒç‰¹æ€§ï¼š
  - è¿”å› iterator
  - yield æš‚åœç‚¹
  - next() æ¢å¤æ‰§è¡Œå¹¶åŒå‘ä¼ å€¼
  - throw() å†…éƒ¨æŠ›å¼‚å¸¸
  - return() æå‰ç»“æŸ
  - yield* å§”æ‰˜åµŒå¥— iterable
  - å¯ç”¨äºæ„é€  iterator
  - å¯ç”¨äºåç¨‹ã€å¼‚æ­¥æµç¨‹æ§åˆ¶
  - æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šè¢«ä¿å­˜
```

è®°ä½ï¼š
**Generator = å¯æ§çš„æ‰§è¡Œå™¨ï¼ˆåç¨‹ï¼‰ + å†…ç½® Iterator**

---

# ğŸ”¥ å…«ã€Generator é«˜è´¨é‡é¢è¯•é¢˜ï¼ˆé™„è§£æï¼‰

ä¸‹é¢è¿™äº›æ˜¯å¤§å‚å¸¸é—®é¢˜ï¼ˆé˜¿é‡Œã€å­—èŠ‚ã€è…¾è®¯éƒ½é—®è¿‡ï¼‰ã€‚

---

## **é¢è¯•é¢˜ 1ï¼šGenerator å’Œæ™®é€šå‡½æ•°çš„åŒºåˆ«ï¼Ÿ**

ç­”é¢˜è¦ç‚¹ï¼š

* Generator å¯æš‚åœ / æ¢å¤ æ‰§è¡Œï¼ˆæ™®é€šå‡½æ•°ä¸è¡Œï¼‰
* é€šè¿‡ `yield` äº§å‡ºå¤šä¸ªå€¼ï¼ˆæ™®é€šå‡½æ•°åªèƒ½ return ä¸€ä¸ªï¼‰
* è°ƒç”¨ä¸ä¼šç«‹å³æ‰§è¡Œï¼Œè€Œæ˜¯è¿”å› iterator
* `next(value)` æ”¯æŒåŒå‘é€šä¿¡
* Generator å¤©ç„¶æ˜¯ iterableï¼ˆæœ‰ `[Symbol.iterator]`ï¼‰
* é€‚åˆå¼‚æ­¥æ§åˆ¶ã€è¿­ä»£å™¨ã€æƒ°æ€§åºåˆ—
* æ‰§è¡Œä¸Šä¸‹æ–‡è¢«ä¿å­˜

---

## **é¢è¯•é¢˜ 2ï¼šè§£é‡Šä¸‹é¢ä»£ç çš„è¾“å‡º**

```js
function* g() {
  const a = yield 1;
  const b = yield a + 2;
  return b * 2;
}

const it = g();
console.log(it.next().value);
console.log(it.next(10).value);
console.log(it.next(5).value);
```

è¾“å‡ºï¼š

```
1
12
10
```

æ ¸å¿ƒé€»è¾‘ï¼š`next(v)` çš„å‚æ•°æ˜¯ â€œä¸Šä¸€æ¬¡ yield çš„è¿”å›å€¼â€ã€‚

---

## **é¢è¯•é¢˜ 3ï¼šä¸ºä»€ä¹ˆ Generator å¯ä»¥å®ç°åç¨‹ï¼Ÿ**

ç­”é¢˜è§’åº¦ï¼ˆå¾ˆå¤šå€™é€‰äººç­”ä¸å‡ºï¼‰ï¼š

* JS æ˜¯å•çº¿ç¨‹ï¼Œä½† Generator å…è®¸å‡½æ•°æš‚åœå’Œæ¢å¤
* çŠ¶æ€è¢«ä¿å­˜åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­
* å¤šä¸ªç”Ÿæˆå™¨å¯äº’ç›¸ `next()` è°ƒç”¨ï¼Œä»è€Œå®ç°â€œååŒåˆ‡æ¢â€
* å®é™…æ˜¯ä¸€ç§ â€œç”¨æˆ·æ€è°ƒåº¦â€

è¿™æ˜¯ redux-saga çš„åŸç†ã€‚

---

## **é¢è¯•é¢˜ 4ï¼šå®ç°ä¸€ä¸ªè‡ªå®šä¹‰çš„ async/awaitï¼ˆåˆ©ç”¨ Generatorï¼‰**

ç®€åŒ–ç‰ˆï¼š

```js
function run(gen) {
  const it = gen();

  function step(nextVal) {
    const { value, done } = it.next(nextVal);
    if (done) return Promise.resolve(value);

    return Promise.resolve(value).then(step);
  }

  return step();
}
```

è¯´æ˜ï¼š

* Generator çš„ yield æš‚åœï¼Œç”¨ Promise.then æ¢å¤
* async/await å°±æ˜¯è¿™ç§æ€æƒ³çš„è¯­æ³•ç³–

è¿™æ˜¯é«˜çº§é¢˜ï¼Œå¤§å‚å¸¸é—®ã€‚

---

## **é¢è¯•é¢˜ 5ï¼šè§£é‡Š `yield*` çš„ä½œç”¨**

ç­”ï¼š

* å§”æ‰˜å¦ä¸€ä¸ª iterable
* è®©å†…éƒ¨ iterable è‡ªåŠ¨å±•å¼€
* å¹¶æŠŠå…¶ return å€¼ä½œä¸º yield* çš„æœ€ç»ˆç»“æœ

ä¾‹é¢˜ä»£ç ï¼š

```js
function* foo() {
  yield 1;
  return 2;
}

function* bar() {
  const res = yield* foo();
  console.log("res:", res);
}

[...bar()]
```

è¾“å‡ºï¼š

```
res: 2
```

---

## **é¢è¯•é¢˜ 6ï¼šå¦‚ä½•ç”¨ Generator å®ç°æ— é™æƒ°æ€§åºåˆ—ï¼Ÿ**

ç­”ï¼š

```js
function* infinite(n = 0) {
  while (true) yield n++;
}
```

---

## **é¢è¯•é¢˜ 7ï¼šGenerator åœ¨å®é™…å¼€å‘ä¸­æœ‰ä»€ä¹ˆç”¨ï¼Ÿ**

æ ‡å‡†å›ç­”ï¼š

* å®ç°æƒ°æ€§æ±‚å€¼ï¼ˆLazy evaluationï¼‰
* æ„é€ å¯è¿­ä»£å¯¹è±¡ï¼ˆè‡ªå®šä¹‰ Iteratorï¼‰
* æ§åˆ¶å¼‚æ­¥æµç¨‹ï¼ˆco / redux-sagaï¼‰
* ç”Ÿæˆæ— é™åºåˆ—ï¼ˆæ•°å­¦åœºæ™¯ï¼‰
* ç¼–å†™æ•°æ®æµç®¡é“
* å®ç°åç¨‹é€»è¾‘ï¼ˆå¤æ‚çŠ¶æ€æœºï¼‰

---

# ğŸ¯ æƒ³ç»§ç»­æå‡ï¼Ÿ

æˆ‘å¯ä»¥ä¸ºä½ æä¾›ï¼š

### 1. **Generator é«˜é¢‘é¢è¯•é¢˜ 50 é¢˜ï¼ˆé™„è§£æï¼‰**

### 2. **Generator + Iterator æ·±åº¦è”åŠ¨é¢˜ï¼ˆå¤§å‚è€ƒå¯Ÿç‚¹ï¼‰**

### 3. **ä¸€å¥—å®Œæ•´çš„ JS è¿­ä»£åè®®å›¾è§£ï¼ˆè¶…è¯¦ç»†ï¼‰**

### 4. **Generator å¼‚æ­¥æ§åˆ¶ä¸“é¢˜ï¼ˆco åŸç†ã€æ‰‹å†™ sagaï¼‰**

ä½ æƒ³è¦å“ªä¸€éƒ¨åˆ†ï¼Ÿ
