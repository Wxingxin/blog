`Map` æ˜¯ä¸€ç§**é”®å€¼å¯¹**é›†åˆçš„**æ•°æ®ç»“æ„**ï¼Œ**ç±»ä¼¼**äºå¯¹è±¡ï¼ˆ`Object`ï¼‰ï¼Œä½†æä¾›äº†æ›´çµæ´»çš„é”®ç±»å‹å’Œæ›´ä¸°å¯Œçš„æ“ä½œæ–¹æ³•ã€‚

| ç‰¹æ€§                         | **Map**                             | **WeakMap**                                         |
| ---------------------------- | ----------------------------------- | --------------------------------------------------- |
| **é”®çš„ç±»å‹**                 | ä»»æ„ç±»å‹ï¼ˆå¯¹è±¡ã€åŸå§‹å€¼éƒ½å¯ä»¥ï¼‰      | **åªèƒ½æ˜¯å¯¹è±¡**ï¼ˆä¸èƒ½æ˜¯æ•°å­—ã€å­—ç¬¦ä¸²ç­‰ primitiveï¼‰    |
| **æ˜¯å¦å¯æšä¸¾**ï¼ˆèƒ½ä¸èƒ½éå†ï¼‰ | âœ” å¯éå†ï¼ˆ`forEach`ã€`forâ€¦of`ï¼‰     | âŒ ä¸å¯éå†ï¼ˆæ²¡æœ‰ sizeï¼Œä¸èƒ½æšä¸¾é”®å€¼ï¼‰              |
| **é”®æ˜¯å¦å¼ºå¼•ç”¨**             | âœ” å¼ºå¼•ç”¨ï¼ˆä¸ä¼šè‡ªåŠ¨é‡Šæ”¾ï¼‰            | â— **å¼±å¼•ç”¨ï¼ˆå¯¹è±¡é”®è‹¥æ— å…¶å®ƒå¼•ç”¨ä¼šè¢« GC è‡ªåŠ¨æ¸…é™¤ï¼‰** |
| **æ˜¯å¦å‚ä¸åƒåœ¾å›æ”¶ï¼ˆGCï¼‰**   | âŒ ä¸ä¼šè‡ªåŠ¨åˆ é™¤é”®ï¼Œå³ä½¿å¯¹è±¡ä¸å†ä½¿ç”¨ | âœ” ä¼šè‡ªåŠ¨åˆ é™¤ä¸å†è¢«å¼•ç”¨çš„ key                        |
| **æ˜¯å¦ä¼šé€ æˆå†…å­˜æ³„æ¼**       | â— æœ‰å¯èƒ½ï¼ˆè‹¥ key æ˜¯å¯¹è±¡ï¼‰          | âœ” ä¸ä¼šï¼ˆæœ€æ ¸å¿ƒä¼˜åŠ¿ï¼‰                                |
| **ä¸»è¦ç”¨é€”**                 | æ™®é€šé”®å€¼å¯¹å­˜å‚¨                      | éœ€è¦ä¸å¯¹è±¡ç»‘å®šæ•°æ®ä¸”ä¸é˜»æ­¢ GC æ—¶                    |
| **æ˜¯å¦èƒ½æŸ¥çœ‹å­˜äº†å¤šå°‘é¡¹ï¼Ÿ**   | âœ” æœ‰ `size` å±æ€§                    | âŒ æ²¡æœ‰ï¼ˆå› ä¸ºé”®ä¼šè¢« GC è‡ªåŠ¨ç§»é™¤ï¼‰                   |

# ğŸ’¯ğŸ’¯ğŸ’¯**Map çš„åŸºæœ¬æ¦‚å¿µ**

1.  **å®šä¹‰**ï¼š`Map` æ˜¯ ES6 æ–°å¢çš„å†…ç½®å¯¹è±¡ï¼Œç”¨äºå­˜å‚¨é”®å€¼å¯¹ï¼Œå…¶ä¸­**é”®å¯ä»¥æ˜¯ä»»æ„ç±»å‹**ï¼ˆåŒ…æ‹¬åŸºæœ¬ç±»å‹ã€å¯¹è±¡ã€å‡½æ•°ç­‰ï¼‰ï¼Œè€Œå¯¹è±¡çš„é”®åªèƒ½æ˜¯å­—ç¬¦ä¸²æˆ– Symbolã€‚

2.  **é”®ï¼ˆkeyï¼‰çš„ç±»å‹**

- åŸºæœ¬ç±»å‹ï¼šå­—ç¬¦ä¸²ï¼ˆStringï¼‰ã€æ•°å­—ï¼ˆNumberï¼‰ã€å¸ƒå°”å€¼ï¼ˆBooleanï¼‰ã€nullã€undefinedã€Symbol
- å¼•ç”¨ç±»å‹ï¼šå¯¹è±¡ï¼ˆObjectï¼‰ã€æ•°ç»„ï¼ˆArrayï¼‰ã€å‡½æ•°ï¼ˆFunctionï¼‰ç­‰
- Map å¯¹é”®çš„æ¯”è¾ƒé‡‡ç”¨ä¸¥æ ¼ç›¸ç­‰ï¼ˆ===ï¼‰ æ ‡å‡†ï¼Œä½†æœ‰ä¸¤ä¸ª**ç‰¹æ®Š**æƒ…å†µï¼š
- ğŸš¨NaN è¢«è§†ä¸ºä¸è‡ªèº«**ç›¸ç­‰**ï¼ˆå³ä½¿ NaN === NaN ç»“æœä¸º falseï¼‰ğŸš¨
- ğŸš¨+0 å’Œ -0 è¢«è§†ä¸º**ç›¸ç­‰**ğŸš¨

3.  **å€¼ï¼ˆvalueï¼‰çš„ç±»å‹ä¸é”®çš„ç±»å‹é™åˆ¶å®Œå…¨ä¸€è‡´**

4.  **ç‰¹æ€§**ï¼š

- é”®çš„**å”¯ä¸€æ€§**ï¼šç›¸åŒçš„é”®åªä¼šä¿ç•™**æœ€åä¸€æ¬¡**è®¾ç½®çš„**å€¼**ã€‚
- **æ’å…¥é¡ºåº**ï¼š`Map` ä¼šè®°ä½é”®å€¼å¯¹çš„æ’å…¥é¡ºåºï¼Œéå†é¡ºåºä¸æ’å…¥é¡ºåºä¸€è‡´ã€‚
- **å¯è¿­ä»£æ€§**ï¼šç›´æ¥æ”¯æŒ `for...of` éå†ï¼Œæ— éœ€é¢å¤–å¤„ç†ã€‚

# **äºŒã€Map çš„åˆ›å»ºä¸æ–¹æ³•**

#### 1. åŸºæœ¬åˆ›å»º

```javascript
// ç©º Map
const map = new Map();

// ä¼ å…¥å¯è¿­ä»£å¯¹è±¡ï¼ˆå¦‚æ•°ç»„ï¼‰åˆå§‹åŒ–
const map = new Map([
  ["name", "Alice"],
  [1, "number"],
  [true, "boolean"],
  [{ key: "obj" }, "object"], // é”®å¯ä»¥æ˜¯å¯¹è±¡
]);
```

#### 2. æ³¨æ„äº‹é¡¹

- åˆå§‹åŒ–æ—¶çš„å¯è¿­ä»£å¯¹è±¡å¿…é¡»æ˜¯**é”®å€¼å¯¹æ•°ç»„çš„é›†åˆ**ï¼ˆå¦‚ `[[key1, value1], [key2, value2]]`ï¼‰ã€‚
- å¯¹è±¡ä½œä¸ºé”®æ—¶ï¼Œæ¯”è¾ƒçš„æ˜¯å¼•ç”¨è€Œéå€¼ï¼š
  ```javascript
  const obj1 = { id: 1 };
  const obj2 = { id: 1 };
  const map = new Map([
    [obj1, "a"],
    [obj2, "b"],
  ]);
  console.log(map.size); // 2ï¼ˆobj1 å’Œ obj2 æ˜¯ä¸åŒå¼•ç”¨ï¼Œè§†ä¸ºä¸¤ä¸ªé”®ï¼‰
  ```

### **ä¸‰ã€Map çš„æ ¸å¿ƒæ–¹æ³•**

#### 1. è®¾ç½®é”®å€¼å¯¹ï¼š`set(key, value)`

- ä½œç”¨ï¼šå‘ `Map` ä¸­æ·»åŠ æˆ–æ›´æ–°é”®å€¼å¯¹ã€‚
- è¿”å›å€¼ï¼šå½“å‰ `Map` å®ä¾‹ï¼ˆå¯é“¾å¼è°ƒç”¨ï¼‰ã€‚

```javascript
const map = new Map();
// åŸºæœ¬ç±»å‹ä½œä¸ºé”®
map.set("stringKey", "å­—ç¬¦ä¸²å€¼");
map.set(123, "æ•°å­—å€¼");
map.set(true, "å¸ƒå°”å€¼");
map.set(null, "nullå€¼");
map.set(undefined, "undefinedå€¼");
map.set(Symbol("symbolKey"), "symbolå€¼");

// å¼•ç”¨ç±»å‹ä½œä¸ºé”®
const objKey = { id: 1 };
const arrKey = [1, 2, 3];
const funcKey = () => {};

map.set(objKey, "å¯¹è±¡ä½œä¸ºé”®");
map.set(arrKey, "æ•°ç»„ä½œä¸ºé”®");
map.set(funcKey, "å‡½æ•°ä½œä¸ºé”®");
```

#### 2. è·å–å€¼ï¼š`get(key)`

- ä½œç”¨ï¼šæ ¹æ®é”®è·å–å¯¹åº”çš„å€¼ã€‚
- è¿”å›å€¼ï¼šå­˜åœ¨åˆ™è¿”å›å¯¹åº”å€¼ï¼Œå¦åˆ™è¿”å› `undefined`ã€‚

```javascript
map.get("name"); // 'Bob'
map.get("gender"); // undefinedï¼ˆé”®ä¸å­˜åœ¨ï¼‰
```

#### 3. åˆ¤æ–­é”®æ˜¯å¦å­˜åœ¨ï¼š`has(key)`

- ä½œç”¨ï¼šæ£€æŸ¥ `Map` ä¸­æ˜¯å¦åŒ…å«æŒ‡å®šçš„é”®ã€‚
- è¿”å›å€¼ï¼šå¸ƒå°”å€¼ï¼ˆ`true` å­˜åœ¨ï¼Œ`false` ä¸å­˜åœ¨ï¼‰ã€‚

```javascript
map.has("age"); // true
map.has("score"); // false
```

#### 4. åˆ é™¤é”®å€¼å¯¹ï¼š`delete(key)`

- ä½œç”¨ï¼šåˆ é™¤æŒ‡å®šé”®å¯¹åº”çš„é”®å€¼å¯¹ã€‚
- è¿”å›å€¼ï¼šå¸ƒå°”å€¼ï¼ˆ`true` åˆ é™¤æˆåŠŸï¼Œ`false` é”®ä¸å­˜åœ¨ï¼‰ã€‚

```javascript
map.delete("isStudent"); // true
map.has("isStudent"); // false
```

#### 5. æ¸…ç©ºæ‰€æœ‰é”®å€¼å¯¹ï¼š`clear()`

- ä½œç”¨ï¼šåˆ é™¤ `Map` ä¸­æ‰€æœ‰é”®å€¼å¯¹ï¼Œæ— è¿”å›å€¼ã€‚

```javascript
map.clear();
map.size; // 0ï¼ˆæ¸…ç©ºåé•¿åº¦ä¸º 0ï¼‰
```

#### 6. è·å–é•¿åº¦ï¼š`size` å±æ€§

- ä½œç”¨ï¼šè¿”å› `Map` ä¸­é”®å€¼å¯¹çš„æ•°é‡ï¼ˆæ³¨æ„æ˜¯å±æ€§ï¼Œä¸æ˜¯æ–¹æ³•ï¼Œæ— éœ€æ‹¬å·ï¼‰ã€‚

```javascript
const map = new Map([
  ["a", 1],
  ["b", 2],
]);
console.log(map.size); // 2
```

### **å››ã€Map çš„éå†æ–¹æ³•**

`Map` æä¾›äº†å¤šç§éå†æ–¹å¼ï¼Œä¸”éå†é¡ºåºä¸æ’å…¥é¡ºåºä¸€è‡´ï¼š

#### 1. `keys()`ï¼šéå†æ‰€æœ‰é”®

```javascript
const map = new Map([
  ["name", "Alice"],
  ["age", 20],
]);
for (const key of map.keys()) {
  console.log(key); // 'name' â†’ 'age'
}
```

#### 2. `values()`ï¼šéå†æ‰€æœ‰å€¼

```javascript
for (const value of map.values()) {
  console.log(value); // 'Alice' â†’ 20
}
```

#### 3. `entries()`ï¼šéå†æ‰€æœ‰é”®å€¼å¯¹ï¼ˆé»˜è®¤éå†å™¨ï¼‰

```javascript
// æ–¹å¼ 1ï¼šä½¿ç”¨ entries()
for (const [key, value] of map.entries()) {
  console.log(`${key}: ${value}`); // 'name: Alice' â†’ 'age: 20'
}

// æ–¹å¼ 2ï¼šç›´æ¥éå† mapï¼ˆç­‰åŒäº entries()ï¼‰
for (const [key, value] of map) {
  console.log(`${key}: ${value}`);
}
```

#### 4. `forEach()`ï¼šå›è°ƒå‡½æ•°éå†

```javascript
map.forEach((value, key, map) => {
  console.log(`${key}: ${value}`); // æ³¨æ„å‚æ•°é¡ºåºï¼švalue åœ¨å‰ï¼Œkey åœ¨å
});
```

### **äº”ã€Map ä¸å…¶ä»–æ•°æ®ç»“æ„çš„è½¬æ¢**

#### 1. Map è½¬æ•°ç»„ï¼ˆ`Array.from()` æˆ–æ‰©å±•è¿ç®—ç¬¦ï¼‰

```javascript
const map = new Map([
  ["a", 1],
  ["b", 2],
]);

// æ–¹å¼ 1ï¼šArray.from()
const arr1 = Array.from(map); // [['a', 1], ['b', 2]]

// æ–¹å¼ 2ï¼šæ‰©å±•è¿ç®—ç¬¦
const arr2 = [...map]; // [['a', 1], ['b', 2]]

// ä»…æå–é”®æˆ–å€¼
const keys = [...map.keys()]; // ['a', 'b']
const values = [...map.values()]; // [1, 2]
```

#### 2. æ•°ç»„è½¬ Map

```javascript
const arr = [
  ["name", "Bob"],
  [1, "num"],
];
const map = new Map(arr);
```

#### 3. Map è½¬å¯¹è±¡ï¼ˆé”®ä¸ºå­—ç¬¦ä¸²æˆ– Symbol æ—¶ï¼‰

```javascript
function mapToObj(map) {
  const obj = {};
  for (const [key, value] of map) {
    if (typeof key === "string" || typeof key === "symbol") {
      obj[key] = value;
    }
  }
  return obj;
}

const map = new Map([
  ["name", "Alice"],
  ["age", 20],
]);
const obj = mapToObj(map); // { name: 'Alice', age: 20 }
```

#### 4. å¯¹è±¡è½¬ Map

```javascript
function objToMap(obj) {
  const map = new Map();
  for (const key in obj) {
    if (obj.hasOwnProperty(key)) {
      map.set(key, obj[key]);
    }
  }
  return map;
}

const obj = { name: "Bob", age: 25 };
const map = objToMap(obj); // Map(2) { 'name' => 'Bob', 'age' => 25 }
```

### **å…­ã€Map ä¸ Object çš„å¯¹æ¯”**

| **ç‰¹æ€§**   | **Map**                          | **Object**                                        |
| ---------- | -------------------------------- | ------------------------------------------------- |
| é”®ç±»å‹     | ä»»æ„ç±»å‹ï¼ˆå­—ç¬¦ä¸²ã€å¯¹è±¡ã€å‡½æ•°ç­‰ï¼‰ | ä»…å­—ç¬¦ä¸²ã€Symbol æˆ–æ•°å­—ï¼ˆè‡ªåŠ¨è½¬ä¸ºå­—ç¬¦ä¸²ï¼‰         |
| é”®çš„å”¯ä¸€æ€§ | è‡ªåŠ¨å»é‡ï¼ˆåŸºäºä¸¥æ ¼ç›¸ç­‰ `===`ï¼‰   | ç›¸åŒé”®ä¼šè¦†ç›–ï¼ˆå¦‚ `{ a: 1, a: 2 }` æœ€ç»ˆä¸º `a: 2`ï¼‰ |
| é•¿åº¦è·å–   | `size` å±æ€§ç›´æ¥è·å–              | éœ€æ‰‹åŠ¨è®¡ç®—ï¼ˆ`Object.keys(obj).length`ï¼‰           |
| éå†æ–¹å¼   | æ”¯æŒ `for...of`ã€`forEach` ç­‰    | éœ€é€šè¿‡ `Object.keys()` ç­‰é—´æ¥éå†                 |
| æ’å…¥é¡ºåº   | ä¿ç•™æ’å…¥é¡ºåº                     | ES6 å‰ä¸ä¿è¯ï¼ŒES6 ååŸºæœ¬ä¿è¯ä½†ä¸æ¨èä¾èµ–          |
| æ€§èƒ½       | é¢‘ç¹å¢åˆ é”®å€¼å¯¹æ—¶æ€§èƒ½æ›´ä¼˜         | é™æ€æ•°æ®æ—¶æ€§èƒ½ç•¥å¥½                                |

### **ä¸ƒã€Map çš„å¸¸è§åº”ç”¨åœºæ™¯**

1. **éœ€è¦éå­—ç¬¦ä¸²é”®çš„åœºæ™¯**ï¼šå¦‚ç”¨å¯¹è±¡æˆ–å‡½æ•°ä½œä¸ºé”®å­˜å‚¨æ•°æ®ã€‚

   ```javascript
   // ç”¨ DOM å…ƒç´ ä½œä¸ºé”®å­˜å‚¨çŠ¶æ€
   const domMap = new Map();
   const button = document.querySelector("button");
   domMap.set(button, { clicked: false });
   ```

2. **é¢‘ç¹å¢åˆ é”®å€¼å¯¹**ï¼š`Map` çš„å¢åˆ æ“ä½œæ€§èƒ½ä¼˜äºå¯¹è±¡ã€‚

3. **éœ€è¦ä¿ç•™æ’å…¥é¡ºåº**ï¼šå¦‚å®ç°æœ‰åºå­—å…¸ã€ç¼“å­˜é˜Ÿåˆ—ç­‰ã€‚

4. **æ•°æ®å»é‡ï¼ˆåŸºäºå€¼ï¼‰**ï¼š

   ```javascript
   function uniqueArray(arr) {
     return [...new Map(arr.map((item) => [item, item])).values()];
   }
   const arr = [1, 2, 2, 3, 3, 3];
   console.log(uniqueArray(arr)); // [1, 2, 3]
   ```

5. **ä¸å…¶ä»– ES6 ç‰¹æ€§é…åˆ**ï¼šå¦‚ç»“åˆ `Set`ã€`Promise` ç­‰å¤„ç†å¤æ‚æ•°æ®ã€‚

### **å…«ã€æ³¨æ„äº‹é¡¹**

1. `Map` çš„é”®æ¯”è¾ƒä½¿ç”¨ä¸¥æ ¼ç›¸ç­‰ï¼ˆ`===`ï¼‰ï¼Œä½† `NaN` è¢«è§†ä¸ºä¸è‡ªèº«ç›¸ç­‰ï¼ˆç‰¹æ®Šå¤„ç†ï¼‰ï¼š

   ```javascript
   const map = new Map();
   map.set(NaN, "a");
   map.get(NaN); // 'a'ï¼ˆå°½ç®¡ NaN !== NaNï¼Œä½† Map ä¸­è§†ä¸ºåŒä¸€é”®ï¼‰
   ```

2. é¿å…ç”¨ `typeof` åˆ¤æ–­ `Map` ç±»å‹ï¼Œåº”ä½¿ç”¨ `instanceof`ï¼š

   ```javascript
   console.log(map instanceof Map); // true
   console.log(typeof map); // 'object'ï¼ˆä¸å‡†ç¡®ï¼‰
   ```

3. `Map` æœ¬èº«æ²¡æœ‰ `JSON.stringify` çš„é»˜è®¤æ”¯æŒï¼Œåºåˆ—åŒ–éœ€æ‰‹åŠ¨å¤„ç†ï¼š
   ```javascript
   // ç®€å•åºåˆ—åŒ–ï¼ˆä»…æ”¯æŒåŸºæœ¬ç±»å‹é”®ï¼‰
   const map = new Map([
     ["name", "Alice"],
     ["age", 20],
   ]);
   const json = JSON.stringify([...map]); // "[[\"name\",\"Alice\"],[\"age\",20]]"
   ```

## 1. ä»€ä¹ˆæ˜¯ WeakMapï¼Ÿ

- `WeakMap` æ˜¯ **ES6** å¼•å…¥çš„ä¸€ç§ç‰¹æ®Šçš„ `Map`ã€‚
- å®ƒçš„ **é”®ï¼ˆkeyï¼‰å¿…é¡»æ˜¯å¯¹è±¡**ï¼ˆéå¯¹è±¡ä¼šæŠ¥é”™ï¼‰ã€‚
- ä¸æ™®é€š `Map` çš„åŒºåˆ«æ˜¯ï¼š

  - `WeakMap` çš„é”®æ˜¯ **å¼±å¼•ç”¨**ï¼Œä¸ä¼šé˜»æ­¢åƒåœ¾å›æ”¶ã€‚
  - å½“å¯¹è±¡æ²¡æœ‰å…¶ä»–å¼•ç”¨æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šè‡ªåŠ¨æ¸…ç†è¿™ä¸ªå¯¹è±¡ä»¥åŠå¯¹åº”çš„é”®å€¼å¯¹ã€‚
  - å› æ­¤ `WeakMap` **ä¸èƒ½è¢«éå†**ï¼Œä¹Ÿæ²¡æœ‰ `size` å±æ€§ã€‚

---

## 2. åŸºæœ¬ç”¨æ³•

```js
// åˆ›å»º WeakMap
const wm = new WeakMap();

const obj1 = { name: "Alice" };
const obj2 = { name: "Bob" };

// è®¾ç½®é”®å€¼å¯¹
wm.set(obj1, "å¼€å‘è€…");
wm.set(obj2, "è®¾è®¡å¸ˆ");

// è·å–
console.log(wm.get(obj1)); // "å¼€å‘è€…"

// åˆ¤æ–­æ˜¯å¦å­˜åœ¨
console.log(wm.has(obj2)); // true

// åˆ é™¤
wm.delete(obj2);
console.log(wm.has(obj2)); // false
```

âš ï¸ ä¸èƒ½ç”¨ `for...of`ã€`forEach`ã€`keys()`ã€`values()` éå†ï¼Œå› ä¸ºé”®ä¼šéšåƒåœ¾å›æ”¶è€Œæ¶ˆå¤±ã€‚

---

## 3. WeakMap çš„ç‰¹ç‚¹

1. **é”®å¿…é¡»æ˜¯å¯¹è±¡**

   ```js
   const wm = new WeakMap();
   wm.set(123, "num"); // âŒ æŠ¥é”™ï¼šInvalid value used as weak map key
   ```

2. **é”®æ˜¯å¼±å¼•ç”¨**

   - `WeakMap` ä¸ä¼šé˜»æ­¢å¯¹è±¡è¢«åƒåœ¾å›æ”¶ã€‚
   - å¦‚æœæŸä¸ªå¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œå®ƒä¼šè‡ªåŠ¨ä» `WeakMap` ä¸­æ¶ˆå¤±ã€‚

3. **ä¸å¯éå†**

   - æ²¡æœ‰ `size`ã€æ²¡æœ‰ `clear()`ã€‚
   - è®¾è®¡ç›®çš„æ˜¯ **é˜²æ­¢å†…å­˜æ³„æ¼**ã€‚

---

## 4. ä½¿ç”¨åœºæ™¯

### (1) ç»™å¯¹è±¡â€œç§æœ‰å±æ€§â€

```js
const privateData = new WeakMap();

class Person {
  constructor(name, age) {
    privateData.set(this, { name, age });
  }

  getName() {
    return privateData.get(this).name;
  }
}

const p1 = new Person("Tom", 20);
console.log(p1.getName()); // "Tom"

// å¤–éƒ¨æ— æ³•ç›´æ¥è®¿é—® name å’Œ age
```

ğŸ‘‰ ç”¨ `WeakMap` ç»™å¯¹è±¡å­˜å‚¨â€œç§æœ‰æ•°æ®â€ï¼Œå½“å¯¹è±¡é”€æ¯æ—¶ï¼Œæ•°æ®ä¹Ÿä¼šè‡ªåŠ¨æ¸…ç†ã€‚

---

### (2) å…³è”é¢å¤–æ•°æ®ï¼Œé¿å…å†…å­˜æ³„æ¼

```js
const wm = new WeakMap();

function setMetadata(obj, meta) {
  wm.set(obj, meta);
}

function getMetadata(obj) {
  return wm.get(obj);
}

let user = { id: 1 };
setMetadata(user, { loggedIn: true });

console.log(getMetadata(user)); // { loggedIn: true }

// å½“ user = null æ—¶ï¼Œè¿™ä¸ªå¯¹è±¡ä¼šè¢«åƒåœ¾å›æ”¶
user = null;
// WeakMap è‡ªåŠ¨æ¸…ç†å¯¹åº”çš„ { loggedIn: true }ï¼Œé¿å…å†…å­˜æ³„æ¼
```

---

## 5. å¯¹æ¯” `Map` å’Œ `WeakMap`

| ç‰¹æ€§      | Map                   | WeakMap                    |
| --------- | --------------------- | -------------------------- |
| é”®ç±»å‹    | ä»»æ„å€¼                | åªèƒ½æ˜¯å¯¹è±¡                 |
| å¼•ç”¨      | å¼ºå¼•ç”¨                | å¼±å¼•ç”¨                     |
| å¯éå†æ€§  | å¯éå†ï¼ˆkeys/valuesï¼‰ | ä¸å¯éå†                   |
| size å±æ€§ | æœ‰                    | æ²¡æœ‰                       |
| å†…å­˜ç®¡ç†  | å¯èƒ½å†…å­˜æ³„æ¼          | è‡ªåŠ¨åƒåœ¾å›æ”¶ï¼Œé¿å…å†…å­˜æ³„æ¼ |

---

âœ… æ€»ç»“ï¼š

- **ç”¨ `WeakMap` å­˜æ”¾å¯¹è±¡çš„ç§æœ‰æ•°æ®æˆ–ä¸´æ—¶æ•°æ®**ï¼Œä¸ç”¨æ‹…å¿ƒå†…å­˜æ³„æ¼ã€‚
- **ç”¨ `Map` å­˜æ”¾éœ€è¦éå†çš„é”®å€¼å¯¹**ã€‚

---

è¦ä¸è¦æˆ‘å¸®ä½ åšä¸€ä¸ª **WeakMap vs Map çš„å¯¹æ¯”åŠ¨å›¾/ASCII åŠ¨ç”»**ï¼Œæ¼”ç¤ºåƒåœ¾å›æ”¶æ—¶ WeakMap çš„é”®å€¼å¯¹æ˜¯å¦‚ä½•è‡ªåŠ¨æ¶ˆå¤±çš„ï¼Ÿ
