##  性能与优化

> ### 1️⃣ 数组和对象访问性能有什么差异？

**答：**

- 数组按下标访问，JS 引擎优化了**连续索引**的内存布局，访问通常比对象属性快。
- 对象按键名访问，键是**哈希**查找，略慢于连续数组索引访问。
- 对**稀疏数组**或**非连续索引**的数组，访问性能接近对象。

---

> ### 2️⃣ 大数组遍历时性能优化的方法？

**答：**

- 使用 **for 循环** 而非高阶方法（forEach、map）减少函数调用开销。
- 避免在循环中重复计算长度或复杂表达式。
- 使用局部变量缓存数组长度或引用。
- 对于只读操作，可使用 **for...of**，语义清晰且性能接近传统 for。

---

### 3️⃣ 使用 splice 删除数组元素与重新创建新数组的性能差异？

**答：**

- `splice` 会修改原数组，删除元素后需移动后续元素，开销随数组长度增加而增加。
- 重新创建新数组（filter/concat）不会移动原数组元素，而是生成新数组，适合处理大数组中间删除元素，可能更高效。
- 总结：少量删除使用 splice，频繁批量删除用新数组方法更好。

---

### 4️⃣ push/pop 与 shift/unshift 哪些操作性能更高？

**答：**

- **push/pop** 操作尾部，时间复杂度 O(1)，性能高。
- **shift/unshift** 操作头部，需移动整个数组元素，时间复杂度 O(n)，性能低。
- 建议尽量在数组尾部操作元素。

---

### 5️⃣ 如何快速清空数组？

**答：**

- 最快方式：`arr.length = 0`，直接修改 length，原数组引用也被清空。
- 其他方式如创建新数组 `arr = []`，只清空当前变量，其他引用不会清空。

---

### 6️⃣ 数组扩容机制是怎样的？

**答：**

- JS 数组底层是动态数组或哈希表混合结构。
- 当数组长度超过当前内存容量时，引擎会 **申请更大的内存块并复制原数组**，实现动态扩容。
- 尽量提前设置合适长度，减少扩容次数，提高性能。

---

### 7️⃣ 使用 for、for...of、forEach、map 遍历数组性能区别？

| 方法     | 性能 | 特点                     |
| -------- | ---- | ------------------------ |
| for      | 最高 | 可控制索引，适合大数组   |
| for...of | 较高 | 可迭代对象，语义清晰     |
| forEach  | 中等 | 内部函数调用，无法 break |
| map      | 较低 | 返回新数组，额外开销     |

---

### 8️⃣ 数组排序大数据量性能如何优化？

**答：**

- 提供 **自定义比较函数**，避免隐式类型转换开销。
- 尽量避免对复杂对象直接排序，使用索引映射排序或 key 提前计算。
- 对部分有序数组，可考虑 **插入排序优化**或第三方高效排序算法。
- 减少排序中临时对象创建和函数调用。

---

### 9️⃣ 数组 concat 和展开运算符（...）性能对比？

**答：**

- `concat` 创建新数组，性能稍高，因为底层优化了数组连接。
- 展开运算符需要展开每个元素到新数组，内存开销稍大。
- 数量少时差异不大，大数组拼接推荐 `concat` 或循环 push 方式。

## 陷阱与易错点


### 1️⃣ 数组的 length 修改会发生什么？

**答：**

- **缩短 length**：数组元素会被删除，超过新 length 的元素被丢弃。
- **增加 length**：数组长度变大，但新增元素为 **空位（undefined 并非真实值）**，不会分配实际内存。

---

### 2️⃣ 数组的下标越界访问会返回什么？

**答：**

- 返回 `undefined`，但数组本身并未改变，length 不受影响。
- 注意：`undefined` 和空位（hole）不同，空位在遍历时可能被跳过。

---

### 3️⃣ 使用 delete 删除数组元素会怎样？

**答：**

- `delete arr[index]` 只删除元素的值，不会改变数组长度，留下 **空位（hole）**。
- 遍历数组时，空位可能被跳过或返回 undefined，可能导致逻辑错误。

---

### 4️⃣ 数组空位（hole）会对遍历产生什么影响？

**答：**

- `forEach`、`map`、`filter`、`reduce` 会**跳过空位**。
- `for` 和 `for...of` 会访问空位，返回 `undefined`。
- 空位可能导致遍历结果不一致，需要注意初始化数组。

---

### 5️⃣ 对数组使用 for...in 会有什么副作用？

**答：**

- for...in 会遍历**所有可枚举属性**，包括原型链上的属性，不仅仅是数组索引。
- 可能导致遍历顺序不按数字索引顺序，产生意外结果。
- 不推荐用于数组遍历。

---

### 6️⃣ 对数组使用 for...of 与 forEach 有什么区别？

| 方法     | 遍历行为       | 是否可跳出          | 空位处理       |
| -------- | -------------- | ------------------- | -------------- |
| for...of | 遍历可迭代对象 | 可用 break/continue | 返回 undefined |
| forEach  | 遍历元素       | 无法跳出            | 跳过空位       |

- 总结：for...of 更灵活，可处理空位；forEach 不可 break，空位会被跳过。

---

### 7️⃣ 数组浅拷贝与深拷贝的区别？

- **浅拷贝**：复制数组的第一层元素，引用类型仍指向原对象。
- **深拷贝**：复制整个数组，包括嵌套对象，修改拷贝不会影响原数组。

---

### 8️⃣ 数组包含对象时，浅拷贝是否安全？

- ❌ 不安全。
- 浅拷贝只复制对象引用，修改嵌套对象会影响原数组中的对象。
- 对于对象数组，修改内部对象必须使用深拷贝。

---

### 9️⃣ 数组 toString 与 join 的输出差异？

- `toString()`：使用逗号 `,` 连接元素，空位会被当作空字符串处理。
- `join(separator)`：使用指定分隔符连接元素，空位同样被视作空字符串，可自定义分隔符。
- 总结：join 更灵活，toString 默认逗号。

---

### 🔟 多维数组 reduce 是否能直接扁平化？

- ❌ reduce 本身不会自动扁平化多维数组，需要配合递归或 concat/flat 实现。
- 直接 reduce 只能对一维数组做累加或合并操作。

## 高级应用


### 1️⃣ 如何实现数组去重？性能最优方法是什么？

**答：**

- 常见方法：`Set` 去重（性能优）、`filter + indexOf`、`reduce`。
- **性能最优**：使用 `Set` 或对象/Map 哈希存储，时间复杂度 O(n)，空间换时间。

---

### 2️⃣ 如何实现数组扁平化？

**答：**

- 一维化：`Array.prototype.flat(depth)`（ES2019+）或递归遍历。
- 适用于任意层级：递归调用 concat 或 reduce。
- 注意：reduce 不能直接扁平化多维数组，需要递归或 flat。

---

### 3️⃣ 如何实现数组求交集、并集、差集？

**答：**

- **交集**：保留在两个数组中都存在的元素，可用 Set + filter。
- **并集**：合并两个数组后去重，可用 Set。
- **差集**：存在于 A 但不在 B 的元素，可用 filter + includes/Set。

---

### 4️⃣ 如何用 reduce 实现 map、filter 功能？

**答：**

- **map**：在 reduce 的累加器中 push 每次映射后的值。
- **filter**：在 reduce 中判断条件成立再 push 元素。
- 本质：reduce 可以模拟数组遍历和累加操作，灵活替代 map/filter。

---

### 5️⃣ 如何实现数组乱序（洗牌算法）？

**答：**

- 常用：Fisher-Yates（现代洗牌算法），线性时间复杂度 O(n)。
- 核心：从后向前遍历数组，每次随机选择一个位置交换元素。
- 注意：不要用 sort + Math.random()，非均匀分布，可能不安全。

---

### 6️⃣ 如何实现数组中最大/最小值查找？

**答：**

- 方法一：`Math.max(...arr)` / `Math.min(...arr)`
- 方法二：reduce 遍历比较累积最大/最小值
- 方法三（大数组）：手动循环，避免展开操作导致栈溢出

---

### 7️⃣ 如何实现数组元素计数统计？

**答：**

- 使用对象或 Map 保存元素出现次数
- 遍历数组，每出现一次，累加计数
- 应用场景：统计单词频率、出现次数等

---

### 8️⃣ 如何实现多维数组转树形结构？

**答：**

- 先构建映射表（id → 节点）
- 遍历数组，将子节点挂载到父节点 children
- 最后返回根节点数组
- 注意处理缺失父节点或循环引用

---

### 9️⃣ 如何判断两个数组是否相等？

**答：**

- 长度不同 → false
- 遍历每个元素逐一比较，引用类型需深度比较
- 对对象数组或多维数组，需要递归比较

---

### 🔟 如何用数组实现栈和队列功能？

- **栈（后进先出 LIFO）**：push（入栈）和 pop（出栈）
- **队列（先进先出 FIFO）**：push（入队）和 shift（出队）
- 可用数组模拟各种数据结构，理解时间复杂度差异（尾部操作更快）

---