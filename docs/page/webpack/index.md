# WebPack äº†è§£ å’Œ é…ç½®

> ### Webpackæ˜¯ä»€ä¹ˆï¼Ÿè§£å†³äº†å“ªäº›é—®é¢˜ï¼Ÿ

**Webpack** æ˜¯ä¸€ä¸ªç°ä»£åŒ–çš„ **å‰ç«¯æ¨¡å—æ‰“åŒ…å·¥å…·ï¼ˆModule Bundlerï¼‰**ã€‚
<font color="red">å®ƒçš„ä¸»è¦ä½œç”¨ï¼š</font>

- æŠŠé¡¹ç›®ä¸­æ‰€æœ‰èµ„æºï¼ˆJSã€CSSã€å›¾ç‰‡ç­‰ï¼‰éƒ½çœ‹ä½œæ¨¡å—ï¼›
- æ ¹æ®ä¾èµ–å…³ç³»æ„å»ºä¾èµ–å›¾ï¼›
- æŠŠè¿™äº›æ¨¡å—æ‰“åŒ…æˆä¸€ä¸ªæˆ–å¤šä¸ªæµè§ˆå™¨å¯è¿è¡Œçš„æ–‡ä»¶ï¼ˆbundleï¼‰ã€‚

**Webpack è§£å†³çš„é—®é¢˜ï¼š**

- æµè§ˆå™¨åŸç”Ÿä¸æ”¯æŒæ¨¡å—åŒ–ï¼›
- å„ç§èµ„æºï¼ˆCSSã€å›¾ç‰‡ï¼‰ä¸èƒ½ç›´æ¥é€šè¿‡ JS ç®¡ç†ï¼›
- å‡å°‘ HTTP è¯·æ±‚æ¬¡æ•°ï¼›
- æé«˜åŠ è½½æ€§èƒ½ï¼›
- æ–¹ä¾¿åš Tree Shakingã€ä»£ç åˆ†å‰²ã€æ‡’åŠ è½½ç­‰ä¼˜åŒ–ã€‚

> ### Webpack çš„æ ¸å¿ƒæ€æƒ³æ˜¯ä»€ä¹ˆï¼Ÿ

Webpack çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

**â€œä¸€åˆ‡çš†æ¨¡å—ï¼Œæœ€ç»ˆæ‰“åŒ…è¾“å‡º<font color=red>ä¼˜åŒ–å</font>çš„<font color=red>é™æ€èµ„æº</font>ã€‚â€**

**è§£é‡Šï¼š**

- æŠŠ JSã€CSSã€å›¾ç‰‡ã€å­—ä½“éƒ½å½“ä½œæ¨¡å—ï¼›
- ä»å…¥å£æ–‡ä»¶å‡ºå‘ï¼Œé€’å½’åˆ†æä¾èµ–ï¼›
- ç”Ÿæˆä¾èµ–å›¾ï¼›
- ç»Ÿä¸€æ‰“åŒ…æˆ bundleã€‚

> ### Webpack çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†

Webpack ä¸»è¦ç”±ä»¥ä¸‹ **5 ä¸ªæ ¸å¿ƒéƒ¨åˆ†** ç»„æˆï¼š

| ç»„æˆéƒ¨åˆ†            | ä½œç”¨                                             | ä¸¾ä¾‹è¯´æ˜                                     |
| --------------- | ---------------------------------------------- | ---------------------------------------- |
| **Entryï¼ˆå…¥å£ï¼‰**   | å‘Šè¯‰ Webpack ä»å“ªä¸ªæ–‡ä»¶å¼€å§‹æ‰“åŒ…                           | `src/index.js` æ˜¯åº”ç”¨çš„èµ·ç‚¹                    |
| **Outputï¼ˆè¾“å‡ºï¼‰**  | å‘Šè¯‰ Webpack æ‰“åŒ…åçš„æ–‡ä»¶è¾“å‡ºåˆ°å“ªé‡Œã€å«ä»€ä¹ˆåå­—                   | è¾“å‡ºåˆ° `dist/bundle.js`                     |
| **Loaderï¼ˆåŠ è½½å™¨ï¼‰** | è®© Webpack èƒ½å¤Ÿå¤„ç†é JS æ–‡ä»¶ï¼ˆå¦‚ CSSã€å›¾ç‰‡ã€TSã€Vueã€React ç­‰ï¼‰ | `css-loader`ã€`babel-loader`              |
| **Pluginsï¼ˆæ’ä»¶ï¼‰** | æ‰©å±• Webpack çš„åŠŸèƒ½ï¼ˆä¼˜åŒ–æ‰“åŒ…ã€å‹ç¼©ã€ç”Ÿæˆ HTML ç­‰ï¼‰              | `HtmlWebpackPlugin`ã€`CleanWebpackPlugin` |
| **Modeï¼ˆæ¨¡å¼ï¼‰**    | æŒ‡å®šæ‰“åŒ…æ¨¡å¼ï¼ˆå¼€å‘æˆ–ç”Ÿäº§ï¼‰ï¼Œå½±å“ä¼˜åŒ–ç¨‹åº¦                           | `development` / `production`             |

---
**å¯é€‰éƒ¨åˆ†ï¼ˆè¿›é˜¶ï¼‰**

| åç§°               | ä½œç”¨                             |
| ---------------- | ------------------------------ |
| **DevServer**    | æœ¬åœ°å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼Œæ”¯æŒçƒ­æ›´æ–°ï¼ˆHMRï¼‰           |
| **Resolve**      | é…ç½®æ¨¡å—è§£æè§„åˆ™ï¼ˆå¦‚åˆ«å aliasã€æ‰©å±•åç­‰ï¼‰       |
| **Optimization** | è‡ªå®šä¹‰ä¼˜åŒ–é…ç½®ï¼Œæ¯”å¦‚ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰ |




> ### webpackæ ¸å¿ƒéƒ¨åˆ†çš„åŸºç¡€ä½¿ç”¨å’Œä½œç”¨

###### 1ï¸âƒ£ Entryï¼ˆå…¥å£ï¼‰

ğŸ“Œ **å·¥ä½œé˜¶æ®µï¼šæ„å»ºå¼€å§‹**

* Webpack ä»å…¥å£æ–‡ä»¶ï¼ˆentryï¼‰å‡ºå‘ï¼Œå»ºç«‹â€œä¾èµ–å…³ç³»å›¾â€ï¼ˆDependency Graphï¼‰ã€‚
* é€’å½’åˆ†ææ‰€æœ‰ `import` / `require` çš„æ¨¡å—ã€‚

**ç¤ºä¾‹ï¼š**

```js
entry: './src/index.js'
```

Webpack ä¼šä»è¿™é‡Œå¼€å§‹ï¼Œä¾æ¬¡æ‰¾åˆ°ä¾èµ–çš„ CSSã€å›¾ç‰‡ã€ç»„ä»¶ç­‰ã€‚

---

###### 2ï¸âƒ£ Resolveï¼ˆæ¨¡å—è§£æï¼‰

ğŸ“Œ **å·¥ä½œé˜¶æ®µï¼šæ¨¡å—åŠ è½½ä¸­**

* å½“ Webpack é‡åˆ° `import './App'` æ—¶ï¼Œå®ƒéœ€è¦çŸ¥é“å»å“ªé‡Œæ‰¾è¿™ä¸ªæ–‡ä»¶ã€‚
* Resolve è´Ÿè´£**è§£ææ¨¡å—è·¯å¾„ã€åˆ«åå’Œæ‰©å±•å**ã€‚

**ç¤ºä¾‹ï¼š**

```js
resolve: {
  alias: { '@': './src' },
  extensions: ['.js', '.jsx', '.json']
}
```

âœ… è®©ä½ å¯ä»¥ç›´æ¥å†™ï¼š

```js
import App from '@/App';
```

---

###### 3ï¸âƒ£ Loaderï¼ˆåŠ è½½å™¨ï¼‰

ğŸ“Œ **å·¥ä½œé˜¶æ®µï¼šæ¨¡å—è½¬æ¢é˜¶æ®µ**

* Webpack é»˜è®¤åªè®¤è¯† JS æ–‡ä»¶ï¼›
* Loader è®©å®ƒèƒ½ç†è§£ CSSã€å›¾ç‰‡ã€TSã€Vue ç­‰æ–‡ä»¶ï¼›
* Loader æ˜¯ä¸€ä¸ªâ€œæ–‡ä»¶è½¬æ¢ç®¡é“â€ï¼Œæ¯ä¸ªåŒ¹é…åˆ°çš„æ–‡ä»¶éƒ½ä¼šç»è¿‡å®ƒçš„å¤„ç†ã€‚

**ç¤ºä¾‹ï¼š**

```js
module: {
  rules: [
    { test: /\.css$/, use: ['style-loader', 'css-loader'] },
    { test: /\.js$/, exclude: /node_modules/, use: 'babel-loader' }
  ]
}
```

ğŸ”„ æ‰§è¡Œé¡ºåºï¼ˆä»å³åˆ°å·¦ï¼‰ï¼š
`index.css` â†’ `css-loader` â†’ `style-loader` â†’ æ³¨å…¥åˆ°é¡µé¢ã€‚

---

###### 4ï¸âƒ£ Pluginsï¼ˆæ’ä»¶ï¼‰

ğŸ“Œ **å·¥ä½œé˜¶æ®µï¼šæ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­**

* Plugin ä¸åƒ Loader é‚£æ ·åªè´Ÿè´£â€œåŠ è½½â€ï¼Œå®ƒå¯ä»¥åœ¨æ•´ä¸ªæ„å»ºè¿‡ç¨‹ä¸­æ’å…¥é€»è¾‘ã€‚
* Webpack æ„å»ºè¿‡ç¨‹æœ‰å¾ˆå¤šé’©å­ï¼ˆHooksï¼‰ï¼Œæ’ä»¶é€šè¿‡è¿™äº›é’©å­æ‰§è¡ŒåŠŸèƒ½ã€‚

**ç¤ºä¾‹ï¼š**

```js
plugins: [
  new HtmlWebpackPlugin({ template: './src/index.html' }),
  new CleanWebpackPlugin()
]
```

ğŸ”¹ æ‰§è¡Œæ—¶æœºï¼š

| é˜¶æ®µ            | æ’ä»¶å¸¸åšçš„äº‹    |
| ------------- | --------- |
| beforeCompile | åˆ é™¤æ—§æ–‡ä»¶     |
| emit          | å†™å…¥æ–°æ–‡ä»¶     |
| afterEmit     | é€šçŸ¥å®Œæˆã€åˆ·æ–°é¡µé¢ |

---

###### 5ï¸âƒ£ Optimizationï¼ˆä¼˜åŒ–ï¼‰

ğŸ“Œ **å·¥ä½œé˜¶æ®µï¼šæ‰“åŒ…å®Œæˆå‰**

* ä»£ç ä¼˜åŒ–é˜¶æ®µã€‚
* Webpack ä¼šåœ¨ç”Ÿæˆæœ€ç»ˆ bundle å‰å¯¹æ¨¡å—è¿›è¡Œå¤„ç†ï¼š

  * **Tree Shaking**ï¼ˆç§»é™¤æ— ç”¨ä»£ç ï¼‰
  * **SplitChunks**ï¼ˆä»£ç åˆ†å‰²ï¼‰
  * **Minimize**ï¼ˆå‹ç¼©ï¼‰

**ç¤ºä¾‹ï¼š**

```js
optimization: {
  splitChunks: { chunks: 'all' },
  minimize: true,
}
```

---

###### 6ï¸âƒ£ Outputï¼ˆè¾“å‡ºï¼‰

ğŸ“Œ **å·¥ä½œé˜¶æ®µï¼šæ„å»ºç»“æŸ**

* å°†æ‰“åŒ…åçš„ç»“æœè¾“å‡ºåˆ°æ–‡ä»¶ç³»ç»Ÿã€‚
* é€šå¸¸æ˜¯ `/dist` æ–‡ä»¶å¤¹ã€‚

**ç¤ºä¾‹ï¼š**

```js
output: {
  path: path.resolve(__dirname, 'dist'),
  filename: 'bundle.js'
}
```

---

###### 7ï¸âƒ£ Modeï¼ˆæ¨¡å¼ï¼‰

ğŸ“Œ **è´¯ç©¿å…¨æµç¨‹**

* å†³å®š Webpack å¯åŠ¨æ—¶å¯ç”¨å“ªäº›é»˜è®¤ä¼˜åŒ–ã€‚

| æ¨¡å¼            | é»˜è®¤è¡Œä¸º                 |
| ------------- | -------------------- |
| `development` | ä¸å‹ç¼©ã€å¸¦ source map     |
| `production`  | è‡ªåŠ¨å‹ç¼©ã€å¯ç”¨ Tree Shaking |

**ç¤ºä¾‹ï¼š**

```js
mode: 'production'
```

---

###### 8ï¸âƒ£ DevServerï¼ˆå¼€å‘æœåŠ¡å™¨ï¼‰

ğŸ“Œ **å·¥ä½œé˜¶æ®µï¼šæ‰“åŒ…å®Œæˆåè¿è¡Œé˜¶æ®µ**

* åœ¨å†…å­˜ä¸­æ„å»ºå¹¶æä¾›å®æ—¶é¢„è§ˆï¼›
* æ”¯æŒ **çƒ­æ›´æ–°ï¼ˆHMRï¼‰**ï¼›
* æ— éœ€æ¯æ¬¡éƒ½é‡æ–°æ‰“åŒ…è¾“å‡ºæ–‡ä»¶ã€‚

**ç¤ºä¾‹ï¼š**

```js
devServer: {
  static: './dist',
  hot: true,
  open: true,
  port: 8080
}
```

ğŸ“˜ å½“ä½ ä¿®æ”¹æ–‡ä»¶æ—¶ï¼š

1. Webpack é‡æ–°æ„å»ºï¼›
2. DevServer æ£€æµ‹å˜åŒ–ï¼›
3. ä½¿ç”¨ HMR çƒ­æ›¿æ¢é¡µé¢ä¸­çš„æ¨¡å—ï¼Œæ— éœ€åˆ·æ–°é¡µé¢ã€‚

###### ğŸ’¬ ä¸€ä¸ªå®Œæ•´é…ç½®ç¤ºä¾‹

```js
// webpack.config.js
const path = require('path');
const HtmlWebpackPlugin = require('html-webpack-plugin');
const { CleanWebpackPlugin } = require('clean-webpack-plugin');

module.exports = {
  mode: 'development',
  entry: './src/index.js', // å…¥å£
  output: {
    path: path.resolve(__dirname, 'dist'), // è¾“å‡ºè·¯å¾„
    filename: 'bundle.js', // è¾“å‡ºæ–‡ä»¶å
  },
  module: {
    rules: [
      { test: /\.css$/, use: ['style-loader', 'css-loader'] }, // å¤„ç†CSS
      { test: /\.js$/, exclude: /node_modules/, use: 'babel-loader' }, // è½¬è¯‘ES6
    ],
  },
  plugins: [
    new CleanWebpackPlugin(), // æ¸…ç†dist
    new HtmlWebpackPlugin({ template: './src/index.html' }), // è‡ªåŠ¨ç”ŸæˆHTML
  ],
  devServer: {
    static: './dist',
    hot: true,
    open: true,
  },
};
```

---


> ### ä»€ä¹ˆæ˜¯æ¨¡å—æ‰“åŒ…ï¼ˆModule Bundlingï¼‰ï¼Ÿ**

æ¨¡å—æ‰“åŒ…ï¼ˆModule Bundlingï¼‰æŒ‡çš„æ˜¯ï¼š

**å°†å¤šä¸ªåˆ†æ•£çš„æ¨¡å—ï¼ˆJSã€CSSã€å›¾ç‰‡ç­‰ï¼‰åŠå…¶ä¾èµ–å…³ç³»ï¼Œç»è¿‡ç¼–è¯‘ã€å¤„ç†ã€åˆå¹¶ï¼Œæœ€ç»ˆè¾“å‡ºä¸ºæµè§ˆå™¨å¯ç›´æ¥è¿è¡Œçš„è‹¥å¹² bundle æ–‡ä»¶çš„è¿‡ç¨‹ã€‚**

å› ä¸ºæµè§ˆå™¨å¤©ç„¶åªæ”¯æŒ ES Modulesï¼ˆä¸”è¾ƒæ–°ï¼‰ä¸ `<script>`ï¼Œè€Œä¸æ”¯æŒï¼š

* Node çš„ CommonJSï¼ˆrequire/module.exportsï¼‰
* TS/JSX
* Sass/Less
* ä»£ç åˆ†å‰² chunk çš„åŠ è½½é€»è¾‘
* Tree Shaking ç­‰ä¼˜åŒ–

æ‰€ä»¥æ‰“åŒ…å·¥å…·ï¼ˆWebpackã€Rollupã€Viteã€Parcelï¼‰éœ€è¦åšï¼š

1. **åˆ†ææ‰€æœ‰ import/require çš„ä¾èµ–å…³ç³»**
2. **å¤„ç†å„ç§æ–‡ä»¶ï¼ˆJSXã€TSã€CSSã€å›¾ç‰‡ç­‰ï¼‰**
3. **æŠŠå®ƒä»¬åˆå¹¶æˆæµè§ˆå™¨èƒ½ç›´æ¥è¿è¡Œçš„ bundle**

æ¯”å¦‚ï¼š

```
index.js â†’ import utils.js â†’ import lodash.js â†’ ...
```

æœ€ç»ˆ Webpack ä¼šç”Ÿæˆï¼š

```
dist/
  main.js
  vendor.js
```


> ###  Webpack é»˜è®¤æ”¯æŒå“ªäº›æ¨¡å—è§„èŒƒï¼Ÿ**

Webpack æ˜¯ä¸€ä¸ªâ€œé€šç”¨æ¨¡å—æ‰“åŒ…å™¨â€ï¼Œå®ƒå¼€ç®±å³æ”¯æŒå¤šç§æ¨¡å—è§„èŒƒï¼š

#### âœ… **1ï¼‰ES Moduleï¼ˆESMï¼‰**

```js
import a from './a.js'
export default ...
```

#### âœ… **2ï¼‰CommonJSï¼ˆCJSï¼‰**

```js
const a = require('./a.js')
module.exports = ...
```

#### âœ… **3ï¼‰AMDï¼ˆAsynchronous Module Definitionï¼‰**

```js
define(['dep'], function(dep){ ... })
```

#### âœ… **4ï¼‰Webpack è‡ªå·±çš„åŠ¨æ€å¯¼å…¥è§„èŒƒ**

```js
import('./a.js')   // ä»£ç åˆ†å‰²ã€æ‡’åŠ è½½
```

#### ï¼ˆæ³¨æ„ï¼‰

* Webpack ä¼šæŠŠæ‰€æœ‰æ¨¡å—ç»Ÿä¸€ç¼–è¯‘æˆæµè§ˆå™¨å¯æ‰§è¡Œçš„ bundle
* Node.js çš„åŸç”Ÿ ESM/CJS å·®å¼‚åœ¨ Webpack å†…éƒ¨éƒ½è¢«æŠ½è±¡æ‰

> ###  **ä»€ä¹ˆæ˜¯ä¾èµ–å›¾è°±ï¼ˆDependency Graphï¼‰ï¼Ÿ**

Webpack çš„æ ¸å¿ƒæ€æƒ³æ˜¯ï¼š

> ä»å…¥å£æ–‡ä»¶å‡ºå‘ï¼Œé€’å½’åˆ†ææ‰€æœ‰ä¾èµ–ï¼Œæ„å»ºå‡ºæ•´ç«™æ‰€æœ‰æ¨¡å—ä¹‹é—´çš„æœ‰å‘å›¾ï¼Œè¿™ä¸ªå›¾ç§°ä¸º **ä¾èµ–å›¾è°±ï¼ˆDependency Graphï¼‰**ã€‚

æ¯”å¦‚å…¥å£æ˜¯ï¼š

```
index.js
```

å®ƒä¾èµ–ï¼š

```
utils.jsã€api.js
```

`utils.js` åˆä¾èµ–ï¼š

```
helper.js
```

Webpack ä¼šæ„å»ºä¸€ä¸ªå›¾ï¼š

```
index.js
 â”œâ”€â”€ utils.js
 â”‚     â””â”€â”€ helper.js
 â””â”€â”€ api.js
```

#### ä¾èµ–å›¾è°±ç”¨äºï¼š

#### **1ï¼‰æ‰“åŒ…æˆ bundle**

Webpack æ ¹æ®ä¾èµ–å›¾å†³å®šæŠŠå“ªäº›æ–‡ä»¶åˆå¹¶è¿› main.js æˆ–åˆ†ç¦»æˆ chunkã€‚

#### **2ï¼‰ä»£ç åˆ†å‰²ï¼ˆSplitChunksï¼‰**

å›¾ä¸­å“ªäº›æ¨¡å—è¢«å¤šä¸ªå…¥å£å¼•ç”¨ â†’ æŠ½æˆ vendor.jsã€‚

#### **3ï¼‰Tree Shaking**

çŸ¥é“å“ªäº›æ¨¡å—æœªè¢«å¼•ç”¨ â†’ åˆ é™¤ã€‚

#### **4ï¼‰æŒ‰éœ€åŠ è½½**

åŠ¨æ€ import æŒ‡å‘çš„æ¨¡å—ä¼šè½åœ¨å›¾è°±ä¸åŒçš„åˆ†æ”¯ â†’ Webpack ç»™å®ƒå•ç‹¬è¾“å‡º chunkã€‚

#### **5ï¼‰å¾ªç¯ä¾èµ–æ£€æµ‹**

å›¾ç»“æ„å¯è®© Webpack æ£€æµ‹å¾ªç¯ importã€‚


> ### **ä»€ä¹ˆæ˜¯ ASTï¼ŸWebpack æ„å»ºä¸­å¦‚ä½•ç”¨åˆ° ASTï¼Ÿ**

#### **ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼ŒAbstract Syntax Treeï¼‰æ˜¯ä»€ä¹ˆï¼Ÿ**

AST æ˜¯å¯¹æºä»£ç çš„ä¸€ç§**ç»“æ„åŒ–æ ‘å½¢è¡¨ç¤º**ã€‚

ä¾‹å¦‚ä»£ç ï¼š

```js
const x = 10;
```

AST çš„ç»“æ„ä¼šè¡¨ç¤ºï¼š

* variable declaration
* identifier(x)
* literal(10)

å®ƒä¸å…³å¿ƒç©ºæ ¼ã€æ³¨é‡Šï¼Œåªå…³æ³¨è¯­æ³•ç»“æ„ã€‚

---

> ### **Webpack / Loader / Plugin å¦‚ä½•ä½¿ç”¨ ASTï¼Ÿ**

Webpack æœ¬èº«ä¾èµ–å¤§é‡ AST å·¥å…·ï¼ˆå¦‚ acornï¼‰ï¼ŒAST æ˜¯ Webpack æ„å»ºçš„æ ¸å¿ƒã€‚

Webpack åœ¨æ„å»ºé˜¶æ®µåšäº†å‡ ä¸ªå…³é”®æ­¥éª¤ï¼š

#### **1ï¼‰è§£æä»£ç  â†’ è½¬ä¸º AST**

Webpack è¯»å–æ¯ä¸ªæ¨¡å—çš„æºä»£ç ï¼Œç„¶åç”¨ parser å°†å…¶è§£æä¸º ASTã€‚

#### **2ï¼‰ä» AST ä¸­æ”¶é›†ä¾èµ–ï¼ˆimport/requireï¼‰**

ä¾‹å¦‚é‡åˆ°ï¼š

```js
import a from './a.js'
```

Webpack é€šè¿‡ AST çŸ¥é“ä½ ä¾èµ–äº† `./a.js`ï¼Œå¹¶ç»§ç»­é€’å½’æ„å»ºä¾èµ–å›¾ã€‚

#### **3ï¼‰å¯¹ä»£ç è¿›è¡Œè½¬è¯‘ï¼ˆå¦‚ Babelï¼‰**

Babel loader åšçš„äº‹æƒ…å°±æ˜¯ï¼š

* è¯»å– JS
* æ„å»º AST
* æ ¹æ®æ’ä»¶ä¿®æ”¹ ASTï¼ˆå¦‚æŠŠ ES6 è½¬ ES5ï¼‰
* å†æ‰“å°æˆ JS

#### **4ï¼‰Tree Shaking ä½¿ç”¨ AST åˆ¤æ–­å“ªäº›ä»£ç æœªè¢«ä½¿ç”¨**

é€šè¿‡åˆ†æ AST ç¡®å®šå“ªäº› exports æ²¡æœ‰è¢«ç”¨åˆ°ï¼Œä»è€Œåˆ é™¤æœªå¼•ç”¨ä»£ç ã€‚

#### **5ï¼‰Minify å‹ç¼©ä¹Ÿä¾èµ– ASTï¼ˆTerserï¼‰**

å‹ç¼©å·¥å…·ä¼šï¼š

* è§£æ AST
* åº”ç”¨å˜æ¢ï¼ˆå˜é‡é‡å‘½åã€åˆ é™¤æ— æ•ˆè¡¨è¾¾å¼ï¼‰
* è¾“å‡ºæœ€å°åŒ– JS

ğŸ‘‰ **ä¸€å¥è¯æ€»ç»“ï¼šWebpack ä¸­å¯¹ JS çš„æ‰€æœ‰åˆ†æã€ä¼˜åŒ–ã€è½¬æ¢éƒ½ç¦»ä¸å¼€ ASTã€‚**



# ğŸ’¯ğŸ’¯ğŸ’¯ ç»†è‡´çš„é…ç½® å’Œ åŒºåˆ«

> ### Webpack çš„ Entry é…ç½®å¯ä»¥æœ‰å“ªäº›å†™æ³•ï¼Ÿ

**Entryï¼ˆå…¥å£ï¼‰** å†³å®šäº† Webpack ä»å“ªé‡Œå¼€å§‹æ„å»ºä¾èµ–å›¾ã€‚

Webpack æ”¯æŒä¸‰ç§å†™æ³• ğŸ‘‡ï¼š

```js
// â‘  å­—ç¬¦ä¸²ï¼šå•å…¥å£
entry: './src/index.js'

// â‘¡ æ•°ç»„ï¼šå¤šä¸ªæ–‡ä»¶åˆå¹¶ä¸ºä¸€ä¸ªå…¥å£ï¼ˆå¸¸ç”¨äºå¤š polyfillï¼‰
entry: ['./src/index.js', './src/polyfill.js']

// â‘¢ å¯¹è±¡ï¼šå¤šå…¥å£ï¼ˆå¸¸ç”¨äºå¤šé¡µé¢åº”ç”¨ï¼‰
entry: {
  home: './src/home.js',
  about: './src/about.js'
}
```

> ###  Output çš„ filename å’Œ chunkFilename åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ

```js
output: {
  filename: '[name].js',           // ä¸»å…¥å£æ–‡ä»¶å‘½å
  chunkFilename: '[name].chunk.js' // éå…¥å£çš„å¼‚æ­¥æ¨¡å—å‘½å
}
```

| å­—æ®µ                | ä½œç”¨                  | ç¤ºä¾‹                           |
| ----------------- | ------------------- | ---------------------------- |
| **filename**      | å…¥å£ï¼ˆEntryï¼‰å¯¹åº”çš„æ‰“åŒ…è¾“å‡ºæ–‡ä»¶å | `main.js`                    |
| **chunkFilename** | åŠ¨æ€åŠ è½½ï¼ˆå¼‚æ­¥ importï¼‰çš„æ–‡ä»¶å | `0.chunk.js`ã€`user.chunk.js` |

ğŸ“˜ **ä¸¾ä¾‹ï¼š**

```js
import('./user.js') // åŠ¨æ€å¼•å…¥
```

è¿™ä¸ªå¼‚æ­¥æ¨¡å—ä¼šä½¿ç”¨ `chunkFilename` å‘½åè§„åˆ™è¾“å‡ºã€‚

---

> ### Loader æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ

**Loader çš„ä½œç”¨ï¼š**

> å°†é JavaScript æ–‡ä»¶ï¼ˆå¦‚ CSSã€å›¾ç‰‡ã€TypeScriptã€Vue æ–‡ä»¶ï¼‰è½¬æ¢ä¸º Webpack èƒ½è¯†åˆ«çš„æ¨¡å—ã€‚

**å·¥ä½œåŸç†ï¼š**

1. Webpack è¯»å–æ¨¡å—ï¼›
2. åŒ¹é…åˆ° `module.rules` ä¸­çš„è§„åˆ™ï¼›
3. åŒ¹é…çš„æ–‡ä»¶ä¼šæŒ‰é¡ºåºï¼ˆä»å³åˆ°å·¦ï¼‰è¢«å¯¹åº”çš„ loader å¤„ç†ï¼›
4. è½¬æ¢åçš„ç»“æœä¼šäº¤ç»™ä¸‹ä¸€ä¸ª loader æˆ– Webpack è‡ªèº«ã€‚

ğŸ“˜ **ä¾‹å­ï¼š**

```js
module: {
  rules: [
    {
      test: /\.css$/,
      use: ['style-loader', 'css-loader']
    }
  ]
}
```

* `css-loader` è§£æ CSS ä¸º JS æ¨¡å—ï¼›
* `style-loader` æŠŠæ ·å¼æ’å…¥åˆ° `<style>` æ ‡ç­¾ä¸­ã€‚

---



> ### Webpack çš„ Mode æœ‰å“ªå‡ ç§ï¼Ÿä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ

Webpack æä¾›ä¸‰ç§æ„å»ºæ¨¡å¼ï¼š

| æ¨¡å¼              | ç‰¹ç‚¹                         |
| --------------- | -------------------------- |
| **development** | å¼€å‘æ¨¡å¼ï¼Œå¯ç”¨è°ƒè¯•ã€æœªå‹ç¼©ã€å¸¦ source map |
| **production**  | ç”Ÿäº§æ¨¡å¼ï¼Œè‡ªåŠ¨å‹ç¼©ã€ä¼˜åŒ– Tree Shaking  |
| **none**        | ä¸å¯ç”¨ä»»ä½•é»˜è®¤ä¼˜åŒ–                  |

```js
mode: 'development' // æˆ– 'production'
```

âœ… **åŒºåˆ«ï¼š**

* development æ¨¡å¼ä¸‹æ„å»ºå¿«ã€å¯è°ƒè¯•ï¼›
* production æ¨¡å¼ä¸‹è‡ªåŠ¨å‹ç¼©ä¼˜åŒ–æ€§èƒ½ã€‚

---

> ###  Plugin ä¸ Loader çš„åŒºåˆ«ï¼Ÿ

1. ä¸¤è€…åœ¨åŸºç¡€å·®åˆ«ï¼š

- loader æ˜¯æ–‡ä»¶åŠ è½½å™¨ï¼Œèƒ½å¤ŸåŠ è½½èµ„æºæ–‡ä»¶ï¼Œå¹¶å¯¹è¿™äº›æ–‡ä»¶è¿›è¡Œä¸€äº›å¤„ç†ï¼Œè¯¸å¦‚ç¼–è¯‘ã€å‹ç¼©ç­‰ï¼Œæœ€ç»ˆä¸€èµ·æ‰“åŒ…åˆ°æŒ‡å®šçš„æ–‡ä»¶ä¸­
- plugin èµ‹äºˆäº† webpack å„ç§çµæ´»çš„åŠŸèƒ½ï¼Œä¾‹å¦‚æ‰“åŒ…ä¼˜åŒ–ã€èµ„æºç®¡ç†ã€ç¯å¢ƒå˜é‡æ³¨å…¥ç­‰ï¼Œç›®çš„æ˜¯è§£å†³ loader æ— æ³•å®ç°çš„å…¶ä»–äº‹
ä»æ•´ä¸ªè¿è¡Œæ—¶æœºä¸Šæ¥çœ‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š


2. ä¸¤è€…åœ¨è¿è¡Œæ—¶æœºä¸Šçš„åŒºåˆ«ï¼š

- loader è¿è¡Œåœ¨æ‰“åŒ…æ–‡ä»¶ä¹‹å‰
- plugins åœ¨æ•´ä¸ªç¼–è¯‘å‘¨æœŸéƒ½èµ·ä½œç”¨
- åœ¨Webpack è¿è¡Œçš„ç”Ÿå‘½å‘¨æœŸä¸­ä¼šå¹¿æ’­å‡ºè®¸å¤šäº‹ä»¶ï¼ŒPlugin å¯ä»¥ç›‘å¬è¿™äº›äº‹ä»¶ï¼Œåœ¨åˆé€‚çš„æ—¶æœºé€šè¿‡Webpackæä¾›çš„ APIæ”¹å˜è¾“å‡ºç»“æœ
- å¯¹äºloaderï¼Œå®è´¨æ˜¯ä¸€ä¸ªè½¬æ¢å™¨ï¼Œå°†Aæ–‡ä»¶è¿›è¡Œç¼–è¯‘å½¢æˆBæ–‡ä»¶ï¼Œæ“ä½œçš„æ˜¯æ–‡ä»¶ï¼Œæ¯”å¦‚å°†A.scssæˆ–A.lessè½¬å˜ä¸ºB.cssï¼Œå•çº¯çš„æ–‡ä»¶è½¬æ¢è¿‡ç¨‹

# ğŸ’¯ğŸ’¯ğŸ’¯ é«˜çº§é…ç½®

## **1ï¸âƒ£ å¦‚ä½•åœ¨ Webpack ä¸­é…ç½®ç¯å¢ƒå˜é‡ï¼Ÿ**

Webpack å¯ä»¥é€šè¿‡ **DefinePlugin** æ³¨å…¥ç¯å¢ƒå˜é‡åˆ°ä»£ç ä¸­ã€‚

### ğŸ“˜ é…ç½®ç¤ºä¾‹

```js
const webpack = require('webpack');

module.exports = {
  plugins: [
    new webpack.DefinePlugin({
      'process.env.NODE_ENV': JSON.stringify(process.env.NODE_ENV || 'development'),
      'process.env.API_BASE_URL': JSON.stringify('https://api.example.com'),
    }),
  ],
};
```

### âœ… æ³¨æ„ç‚¹

* `DefinePlugin` æ˜¯æ–‡æœ¬æ›¿æ¢ï¼Œä¸æ˜¯æ³¨å…¥å˜é‡ï¼›
* é€šå¸¸é…åˆ `.env` æ–‡ä»¶ä½¿ç”¨ `dotenv` åŠ è½½ã€‚

---


## **3ï¸âƒ£ å¦‚ä½•æå–å…¬å…±ä»£ç ï¼ˆSplitChunksPluginï¼‰ï¼Ÿ**

Webpack 5 å†…ç½® **SplitChunksPlugin**ï¼Œç”¨äºæå–å…¬å…±æ¨¡å—ï¼Œå‡å°‘é‡å¤ä»£ç ã€‚

### ğŸ“˜ é…ç½®ç¤ºä¾‹

```js
module.exports = {
  optimization: {
    splitChunks: {
      chunks: 'all', // all: åŒæ­¥ + å¼‚æ­¥æ¨¡å—éƒ½åˆ†å‰²
      cacheGroups: {
        vendors: {
          test: /[\\/]node_modules[\\/]/,
          name: 'vendors',
          chunks: 'all',
        },
        commons: {
          test: /[\\/]src[\\/]components[\\/]/,
          name: 'commons',
          minChunks: 2,
        },
      },
    },
  },
};
```

âœ… ä¼˜ç‚¹ï¼š

* é¿å…é‡å¤æ‰“åŒ…ç¬¬ä¸‰æ–¹åº“ï¼›
* æå‡ç¼“å­˜åˆ©ç”¨ç‡ï¼›
* å‡å°‘ä¸» bundle ä½“ç§¯ã€‚

---


## **6ï¸âƒ£ å¦‚ä½•åœ¨ Webpack ä¸­å¼€å¯ gzip å‹ç¼©ï¼Ÿ**

ä½¿ç”¨ **compression-webpack-plugin**ã€‚

### ğŸ“˜ é…ç½®ç¤ºä¾‹

```bash
npm install compression-webpack-plugin -D
```

```js
const CompressionPlugin = require('compression-webpack-plugin');

module.exports = {
  plugins: [
    new CompressionPlugin({
      test: /\.(js|css)$/,
      algorithm: 'gzip',
      threshold: 10240,
      minRatio: 0.8,
    }),
  ],
};
```

âœ… æ³¨æ„ï¼š

* ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ï¼›
* æœåŠ¡å™¨éœ€é…ç½®è¯»å– `.gz` æ–‡ä»¶æˆ–å¯ç”¨å‹ç¼©ä¼ è¾“ã€‚

---

## **4ï¸âƒ£ å¦‚ä½•é…ç½®å›¾ç‰‡ã€å­—ä½“ç­‰é™æ€èµ„æºï¼Ÿ**

Webpack 5 æ¨èä½¿ç”¨ **Asset Modules**ï¼Œæ— éœ€é¢å¤– loaderã€‚

### ğŸ“˜ é…ç½®ç¤ºä¾‹

```js
module.exports = {
  module: {
    rules: [
      {
        test: /\.(png|jpe?g|gif|svg)$/i,
        type: 'asset', // è‡ªåŠ¨é€‰æ‹© inline / resource
        parser: { dataUrlCondition: { maxSize: 8 * 1024 } }, // å°äº 8KB inline
      },
      {
        test: /\.(woff2?|eot|ttf|otf)$/i,
        type: 'asset/resource',
      },
    ],
  },
};
```

* `asset/resource` â†’ ç”Ÿæˆæ–‡ä»¶ï¼›
* `asset/inline` â†’ å†…è” base64ï¼›
* `asset` â†’ è‡ªåŠ¨é€‰æ‹©ã€‚


# ğŸ’¯ğŸ’¯ğŸ’¯ æ‰“åŒ…æµç¨‹
 
> ### Webpack æ‰“åŒ…çš„æ€»ä½“æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       å¯åŠ¨ Webpack          â”‚
â”‚  (CLIå‘½ä»¤/DevServerå¯åŠ¨)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1ï¸âƒ£ è¯»å–é…ç½® (webpack.config.js)      â”‚
â”‚  è§£æ Entryã€Outputã€Loadersã€Plugins â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2ï¸âƒ£ æ ¹æ® Entry æ„å»ºä¾èµ–å›¾        â”‚
â”‚  ä»å…¥å£æ–‡ä»¶å‡ºå‘ï¼Œåˆ†æ import ä¾èµ–  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3ï¸âƒ£ ç»è¿‡ Loaders è½¬æ¢æ¨¡å—       â”‚
â”‚  å¤„ç†é JS æ–‡ä»¶ï¼Œå¦‚ CSSã€å›¾ç‰‡ã€TS â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4ï¸âƒ£ æ’ä»¶ Plugins æ‰§è¡Œç”Ÿå‘½å‘¨æœŸé’©å­ â”‚
â”‚  ä¼˜åŒ–ã€å‹ç¼©ã€ç”Ÿæˆ HTML ç­‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5ï¸âƒ£ ä»£ç ä¼˜åŒ– Optimization é˜¶æ®µ  â”‚
â”‚  Tree Shakingã€ä»£ç åˆ†å‰²ã€å‹ç¼©    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6ï¸âƒ£ è¾“å‡ºåˆ° Output ç›®å½•         â”‚
â”‚  è¾“å‡ºæœ€ç»ˆçš„ bundle.js / èµ„æºæ–‡ä»¶ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚
              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  7ï¸âƒ£ DevServer å¯åŠ¨æœåŠ¡ï¼ˆå¼€å‘æ¨¡å¼ï¼‰â”‚
â”‚  æä¾›æœ¬åœ°é¢„è§ˆ + çƒ­æ›´æ–° (HMR)     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

> ### **2ï¸âƒ£ Webpack çš„ä¾èµ–æ”¶é›†æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ**

Webpack æ„å»ºæ—¶ï¼Œä¼šä½¿ç”¨ **ASTï¼ˆæŠ½è±¡è¯­æ³•æ ‘ï¼‰** æ¥åˆ†æä»£ç ç»“æ„ï¼š

1. è°ƒç”¨ **Parserï¼ˆè§£æå™¨ï¼‰** å°†æ¨¡å—æºä»£ç è½¬æˆ ASTã€‚
2. éå† ASTï¼Œè¯†åˆ«å‡ºï¼š

   * `import ... from ...`
   * `require(...)`
   * åŠ¨æ€ `import()`
3. æŠŠä¾èµ–æ¨¡å—è·¯å¾„æ”¶é›†èµ·æ¥ï¼ŒåŠ å…¥ä¾èµ–å›¾ã€‚
4. é€’å½’åˆ†ææ¯ä¸€ä¸ªä¾èµ–æ¨¡å—ï¼Œé‡å¤è¿™ä¸ªè¿‡ç¨‹ã€‚

æœ€ç»ˆå½¢æˆä¸€ä¸ª**æ¨¡å—ä¾èµ–å›¾ï¼ˆModule Graphï¼‰**ï¼ŒWebpack å°±èƒ½æ®æ­¤æ‰“åŒ…å‡ºæ•´ä¸ªé¡¹ç›®ã€‚

---

> ### **3ï¸âƒ£ Loader çš„æ‰§è¡Œé¡ºåºæ˜¯æ€æ ·çš„ï¼Ÿ**

Loader æ˜¯ä¸€ä¸ª **å‡½æ•°é“¾**ï¼Œæ‰§è¡Œé¡ºåºä¸ºï¼š

> **ä»å³åˆ°å·¦ï¼ˆä»ä¸‹åˆ°ä¸Šï¼‰æ‰§è¡Œã€‚**

åŸå› ï¼šWebpack é‡‡ç”¨â€œç®¡é“æµâ€æ€æƒ³ï¼Œåä¸€ä¸ª loader çš„è¾“å‡ºä¼šä½œä¸ºå‰ä¸€ä¸ªçš„è¾“å…¥ã€‚

ğŸ“¦ ä¾‹å¦‚ï¼š

```js
use: ['style-loader', 'css-loader', 'postcss-loader']
```

æ‰§è¡Œé¡ºåºï¼š

1. `postcss-loader`
2. `css-loader`
3. `style-loader`

å¦‚æœ loader æ˜¯ **pitching loader**ï¼Œåˆ™è¿˜æœ‰ä¸€ä¸ªâ€œä»å·¦åˆ°å³â€çš„å‰ç½®æ‰§è¡Œé˜¶æ®µã€‚

---

> ### **4ï¸âƒ£ Plugin çš„æ‰§è¡ŒåŸç†ï¼Ÿ**

Webpack çš„æ’ä»¶ç³»ç»ŸåŸºäº **Tapable åº“**ï¼ˆå®ç°å‘å¸ƒ-è®¢é˜…æ¨¡å¼ï¼‰ã€‚

ğŸ“¦ æœºåˆ¶ç®€è¿°ï¼š

* Webpack åœ¨è¿è¡Œæ—¶ï¼Œä¼šåœ¨ä¸åŒé˜¶æ®µè§¦å‘ä¸€ç³»åˆ— **é’©å­ï¼ˆhooksï¼‰**ã€‚
* æ’ä»¶é€šè¿‡æ³¨å†Œè¿™äº›é’©å­ï¼ˆ`compiler.hooks.emit.tapAsync()` ç­‰ï¼‰æ¥æ‰§è¡Œé€»è¾‘ã€‚
* æ¯”å¦‚ï¼š`HtmlWebpackPlugin` åœ¨ `emit` é˜¶æ®µä¿®æ”¹è¾“å‡ºèµ„æºã€‚

ğŸ”§ ç¤ºä¾‹ï¼š

```js
class MyPlugin {
  apply(compiler) {
    compiler.hooks.emit.tap('MyPlugin', (compilation) => {
      console.log('emit é˜¶æ®µè§¦å‘');
    });
  }
}
```

---

> ### **5ï¸âƒ£ Webpack çš„æ„å»ºç”Ÿå‘½å‘¨æœŸï¼ˆCompilerã€Compilationï¼‰**

Webpack æœ‰ä¸¤ä¸ªæ ¸å¿ƒå¯¹è±¡ï¼š

* **Compiler**ï¼šæ•´ä¸ª Webpack ç”Ÿå‘½å‘¨æœŸçš„ç®¡ç†è€…ï¼ˆå…¨å±€å”¯ä¸€ï¼‰ã€‚
* **Compilation**ï¼šä¸€æ¬¡æ„å»ºè¿‡ç¨‹çš„ä¸Šä¸‹æ–‡ï¼ˆæ¯æ¬¡ç¼–è¯‘éƒ½æ–°å»ºä¸€ä¸ªï¼‰ã€‚

ğŸ” **å¸¸è§ç”Ÿå‘½å‘¨æœŸé’©å­ï¼š**

| é˜¶æ®µ            | ä½œç”¨               |
| ------------- | ---------------- |
| `environment` | åˆå§‹åŒ–ç¯å¢ƒ            |
| `run`         | å¼€å§‹ä¸€æ¬¡ç¼–è¯‘           |
| `compile`     | åˆ›å»ºæ–°çš„ Compilation |
| `make`        | ä» entry å¼€å§‹è§£æä¾èµ–   |
| `emit`        | è¾“å‡ºæ–‡ä»¶åˆ°ç£ç›˜å‰         |
| `done`        | æ„å»ºå®Œæˆ             |

ğŸ§  é¢è¯•å…³é”®è¯ï¼šâ€œCompiler ç®¡å…¨å±€ã€Compilation ç®¡å•æ¬¡ç¼–è¯‘â€ã€‚

---

> ### **6ï¸âƒ£ Webpack å¦‚ä½•è§£ææ¨¡å—è·¯å¾„ï¼Ÿ**

Webpack ä½¿ç”¨è‡ªå®šä¹‰çš„æ¨¡å—è§£æå™¨ï¼ˆåŸºäº enhanced-resolveï¼‰ï¼š

è§£ææ­¥éª¤ï¼š

1. æ£€æŸ¥æ˜¯å¦ä¸ºç»å¯¹è·¯å¾„ï¼›
2. è‹¥æ˜¯ç›¸å¯¹è·¯å¾„ï¼ˆ`./`ã€`../`ï¼‰ï¼Œä»å½“å‰æ–‡ä»¶ç›®å½•è§£æï¼›
3. è‹¥ä¸ºæ¨¡å—åï¼š

   * æŸ¥æ‰¾ `resolve.alias`
   * æŸ¥æ‰¾ `resolve.modules`ï¼ˆé»˜è®¤ `node_modules`ï¼‰
   * æŸ¥æ‰¾ `resolve.extensions`ï¼ˆå¦‚ `.js`, `.ts`, `.jsx`ï¼‰
   * éµå¾ª Node.js æ¨¡å—è§£æç®—æ³•ã€‚

---
> ###

> ###

> ###

> ###

# ğŸ’¯ğŸ’¯ğŸ’¯ æ€§èƒ½ä¼˜åŒ– å’Œ ç›¸åº”çš„ç»†è‡´

>### **1ï¸âƒ£ å¦‚ä½•ä¼˜åŒ– Webpack çš„æ„å»ºé€Ÿåº¦ï¼Ÿ**

æ„å»ºé€Ÿåº¦ä¼˜åŒ–æ ¸å¿ƒæ€è·¯æ˜¯ï¼šâ€œ**å‡å°‘è¦ç¼–è¯‘çš„å†…å®¹ + æé«˜ç¼–è¯‘æ•ˆç‡ + åˆ©ç”¨ç¼“å­˜**â€ã€‚

#### âœ… å¸¸ç”¨æ‰‹æ®µï¼š

| ä¼˜åŒ–æ–¹å‘                  | æ–¹æ³•                                    | ç¤ºä¾‹                            |
| ------------------------- | --------------------------------------- | ------------------------------- |
| **1. ç¼“å­˜**               | å¯ç”¨æŒä¹…åŒ–ç¼“å­˜                          | `cache: { type: 'filesystem' }` |
| **2. å¤šè¿›ç¨‹æ„å»º**         | ä½¿ç”¨ `thread-loader` æˆ– `HappyPack`     | JS/TS è½¬è¯‘å¹¶è¡Œ                  |
| **3. ç¼©å°ç¼–è¯‘èŒƒå›´**       | é…ç½® `include/exclude`ã€`resolve.alias` | å‡å°‘æ–‡ä»¶æœç´¢è·¯å¾„                |
| **4. åˆç†ä½¿ç”¨ SourceMap** | å¼€å‘ä½¿ç”¨ `cheap-module-source-map`      | å‡å°‘æ˜ å°„ç”Ÿæˆæ—¶é—´                |
| **5. å…³é—­æ— ç”¨æ’ä»¶**       | ä»…åœ¨ç”Ÿäº§ä½¿ç”¨å¦‚ `MiniCssExtractPlugin`   |                                 |
| **6. ä½¿ç”¨ DLLï¼ˆè€æ–¹æ³•ï¼‰** | å°†ä¸å˜ä¾èµ–æå‰ç¼–è¯‘                      | `DllPlugin`                     |
| **7. ä½¿ç”¨æ›´å¿«ç¼–è¯‘å™¨**     | ä½¿ç”¨ `esbuild-loader` / `swc-loader`    | æ›¿ä»£ Babel æé€Ÿ 10x             |

---

> ### **2ï¸âƒ£ å¦‚ä½•ä¼˜åŒ– Webpack çš„æ‰“åŒ…ä½“ç§¯ï¼Ÿ**

æ ¸å¿ƒç›®æ ‡ï¼šâ€œ**è®©æœ€ç»ˆäº§ç‰©æ›´å°ã€æ›´å°‘ã€æ›´é«˜æ•ˆ**â€ã€‚

#### âœ… ä¼˜åŒ–æ–¹æ³•ï¼š

| ä¼˜åŒ–æ–¹å‘              | æ–¹æ³•                                  | ç¤ºä¾‹                                    |
| --------------------- | ------------------------------------- | --------------------------------------- |
| **1. Tree Shaking**   | æ¸…é™¤æ— ç”¨ä»£ç                           | å†…ç½®äºç”Ÿäº§æ¨¡å¼                          |
| **2. ä»£ç åˆ†å‰²**       | `SplitChunksPlugin`                   | æå–å…¬å…±ä¾èµ–                            |
| **3. å‹ç¼©ä»£ç **       | `TerserPlugin` + `CssMinimizerPlugin` | å»æ‰æ³¨é‡Š/ç©ºæ ¼                           |
| **4. å›¾ç‰‡ä¼˜åŒ–**       | `image-minimizer-webpack-plugin`      | WebP å‹ç¼©                               |
| **5. æŒ‰éœ€åŠ è½½**       | åŠ¨æ€ import + è·¯ç”±æ‡’åŠ è½½              | Vue/React åˆ†é¡µåŠ è½½                      |
| **6. externals**      | æ’é™¤å¤–éƒ¨åº“                            | CDN åŠ è½½ React/Vue                      |
| **7. ä½¿ç”¨ CDN**       | å°†èµ„æºæ”¾åœ¨ CDN ä¸Š                     | å‡å°‘ä¸»åŒ…ä½“ç§¯                            |
| **8. Scope Hoisting** | æ¨¡å—åˆå¹¶                              | `optimization.concatenateModules: true` |

---



### **3ï¸âƒ£ ä»€ä¹ˆæ˜¯ Tree Shakingï¼Ÿå®ç°åŸç†ï¼Ÿ**

> Tree Shaking æ˜¯ä¸€ç§**æ¶ˆé™¤æœªä½¿ç”¨ä»£ç ï¼ˆDead Code Eliminationï¼‰**çš„æŠ€æœ¯ã€‚

#### âœ¨ å®ç°åŸç†ï¼š

1. **ESM é™æ€åˆ†æ**
   Webpack é€šè¿‡åˆ†æ ES Moduleï¼ˆ`import/export`ï¼‰è¯­æ³•ï¼Œè¯†åˆ«å“ªäº›å¯¼å‡ºæœªè¢«ä½¿ç”¨ï¼›
2. **æ ‡è®°æœªä½¿ç”¨ä»£ç **ï¼ˆæ ‡è®°ä¸º `/* unused harmony export */`ï¼‰ï¼›
3. **Terser ç­‰å‹ç¼©å·¥å…·åœ¨å‹ç¼©é˜¶æ®µåˆ é™¤æ— ç”¨ä»£ç ã€‚**

```js
// utils.js
export function used() {}
export function unused() {}

// index.js
import { used } from "./utils";
used();
```

æ‰“åŒ…ååªä¿ç•™ `used()`ã€‚

---

### **4ï¸âƒ£ Tree Shaking æœ‰å“ªäº›å±€é™æ€§ï¼Ÿ**

| å±€é™æ€§                   | åŸå›                                                              |
| ------------------------ | ---------------------------------------------------------------- |
| **å¿…é¡»ä½¿ç”¨ ES Module**   | å› ä¸ºåªæœ‰ ESM æ˜¯é™æ€å¯åˆ†æçš„ï¼Œ`require` æ˜¯åŠ¨æ€çš„                  |
| **å‰¯ä½œç”¨æ–‡ä»¶æ— æ³•æ‘‡æ‰**   | è‹¥æ–‡ä»¶æœ‰å‰¯ä½œç”¨ï¼ˆå¦‚å…¨å±€ä¿®æ”¹ï¼‰ï¼ŒWebpack ä¸ä¼šåˆ é™¤                   |
| **åŠ¨æ€å¼•å…¥éš¾åˆ†æ**       | å¦‚ `import('module_' + name)` æ— æ³•é™æ€ç¡®å®š                       |
| **ç¬¬ä¸‰æ–¹åº“æœªå£°æ˜å‰¯ä½œç”¨** | å¿…é¡»åœ¨ `package.json` ä¸­é…ç½® `"sideEffects": false` æ‰èƒ½å®Œå…¨ç”Ÿæ•ˆ |

---

### **5ï¸âƒ£ ä»€ä¹ˆæ˜¯ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰ï¼Ÿ**

> ä»£ç åˆ†å‰²æ˜¯å°†é¡¹ç›®æ‰“åŒ…ä¸ºå¤šä¸ª bundleï¼Œä»¥ä¾¿æŒ‰éœ€åŠ è½½ã€å‡å°‘é¦–å±ä½“ç§¯ã€‚

#### ğŸ’¡ å®ç°æ–¹å¼ï¼š

1. **å¤šå…¥å£æ‰“åŒ…**

   ```js
   entry: {
     home: './src/home.js',
     about: './src/about.js',
   }
   ```

2. **åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importï¼‰**

   ```js
   import("./login").then((m) => m.init());
   ```

3. **SplitChunksPlugin è‡ªåŠ¨åˆ†å‰²**

   ```js
   optimization: {
     splitChunks: {
       chunks: 'all',
     },
   }
   ```

---

### **6ï¸âƒ£ å¦‚ä½•é…ç½®åŠ¨æ€å¯¼å…¥ï¼ˆDynamic Importï¼‰ï¼Ÿ**

åŠ¨æ€å¯¼å…¥ä½¿ç”¨ **import() å‡½æ•°è¯­æ³•**ï¼ŒWebpack è‡ªåŠ¨åˆ†åŒ…ã€‚

```js
// example.js
button.onclick = () => {
  import("./dialog").then(({ openDialog }) => openDialog());
};
```

é…ç½®ï¼ˆä»…éœ€ Babel æ”¯æŒï¼‰ï¼š

```bash
npm install @babel/plugin-syntax-dynamic-import -D
```

Webpack ä¼šè‡ªåŠ¨å°† `./dialog` ç”Ÿæˆä¸ºç‹¬ç«‹ chunkã€‚

---

### **7ï¸âƒ£ å¦‚ä½•å¼€å¯æŒä¹…åŒ–ç¼“å­˜ï¼ˆPersistent Cachingï¼‰ï¼Ÿ**

Webpack 5 å¼€ç®±å³ç”¨æ–‡ä»¶ç³»ç»Ÿç¼“å­˜ï¼š

```js
module.exports = {
  cache: {
    type: "filesystem", // å¯ç”¨æ–‡ä»¶ç³»ç»Ÿç¼“å­˜
    buildDependencies: {
      config: [__filename], // å½“é…ç½®æ–‡ä»¶æ”¹åŠ¨æ—¶æ¸…é™¤ç¼“å­˜
    },
  },
};
```

âœ¨ ä¼˜ç‚¹ï¼š

- äºŒæ¬¡æ„å»ºé€Ÿåº¦æå‡ 70%+
- è‡ªåŠ¨ç¼“å­˜ loaderã€æ’ä»¶ç»“æœ
- æ”¯æŒè·¨è¿›ç¨‹å…±äº«ç¼“å­˜

---

### **8ï¸âƒ£ å¦‚ä½•åˆ©ç”¨ `externals` ä¼˜åŒ–æ„å»ºï¼Ÿ**

> `externals` ç”¨äº**æ’é™¤ä¸å¸Œæœ›è¢«æ‰“åŒ…è¿› bundle çš„ä¾èµ–**ï¼Œè®©å…¶åœ¨è¿è¡Œæ—¶é€šè¿‡ CDN æˆ–å…¨å±€å˜é‡æä¾›ã€‚

```js
// webpack.config.js
externals: {
  react: 'React',
  'react-dom': 'ReactDOM',
}
```

ç„¶ååœ¨ HTML ä¸­æ‰‹åŠ¨å¼•å…¥ï¼š

```html
<script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.production.min.js"></script>
```

âœ… ä¼˜ç‚¹ï¼š

- å‡å°‘ bundle ä½“ç§¯ï¼›
- é¿å…é‡å¤æ‰“åŒ… React/Vueï¼›
- æå‡æ‰“åŒ…é€Ÿåº¦ã€‚

---

### **9ï¸âƒ£ ä»€ä¹ˆæ˜¯æ‡’åŠ è½½ï¼ˆLazy Loadingï¼‰ï¼Ÿ**

> æ‡’åŠ è½½æ˜¯ä¸€ç§ **æŒ‰éœ€åŠ è½½èµ„æº** çš„æŠ€æœ¯ï¼Œä»…åœ¨éœ€è¦æ—¶æ‰åŠ è½½å¯¹åº”æ¨¡å—ã€‚

å…¸å‹åœºæ™¯ï¼š

- è·¯ç”±æ‡’åŠ è½½ï¼›
- å›¾ç‰‡æ‡’åŠ è½½ï¼›
- ç»„ä»¶æŒ‰éœ€åŠ è½½ã€‚

ğŸ“˜ ç¤ºä¾‹ï¼ˆReactï¼‰ï¼š

```js
import React, { lazy, Suspense } from "react";

const Profile = lazy(() => import("./Profile"));

function App() {
  return (
    <Suspense fallback={<div>Loading...</div>}>
      <Profile />
    </Suspense>
  );
}
```

Webpack ä¼šä¸º `Profile` ç”Ÿæˆç‹¬ç«‹ chunkã€‚

---

### **ğŸ”Ÿ å¦‚ä½•å‡å°‘é‡å¤ä»£ç å’Œä¾èµ–ï¼Ÿ**

| æ–¹æ³•                    | è¯´æ˜                                    |
| ----------------------- | --------------------------------------- |
| **SplitChunksPlugin**   | è‡ªåŠ¨æŠ½ç¦»å…¬å…±æ¨¡å—                        |
| **externals**           | æå–ç¬¬ä¸‰æ–¹åº“åˆ° CDN                      |
| **å»é™¤é‡å¤ä¾èµ–ç‰ˆæœ¬**    | ä½¿ç”¨ `npm dedupe` æˆ– `yarn-deduplicate` |
| **ä½¿ç”¨ alias ç»Ÿä¸€ä¾èµ–** | é¿å… `react`ã€`react-dom` ç‰ˆæœ¬é‡å¤      |
| **Scope Hoisting**      | æå‡è¿è¡Œæ•ˆç‡ã€å‡å°‘åŒ…è£¹å±‚                |
| **åŠ¨æ€å¯¼å…¥**            | æŒ‰éœ€åŠ è½½å‡å°‘ä¸»åŒ…ä½“ç§¯                    |

```js
optimization: {
  splitChunks: {
    chunks: 'all',
    cacheGroups: {
      vendor: {
        test: /[\\/]node_modules[\\/]/,
        name: 'vendors',
        chunks: 'all',
      },
    },
  },
}
```







# ğŸ’¯ğŸ’¯ğŸ’¯

# ğŸ’¯ğŸ’¯ğŸ’¯
